<!DOCTYPE html>
<html lang="hi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>üåæ ‡§ï‡•É‡§∑‡§ø‡§Æ‡§ø‡§§‡•ç‡§∞ AI - ‡§ï‡§ø‡§∏‡§æ‡§®‡•ã‡§Ç ‡§ï‡§æ ‡§∏‡§¨‡§∏‡•á ‡§Ö‡§ö‡•ç‡§õ‡§æ ‡§¶‡•ã‡§∏‡•ç‡§§ - v2.1</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .navbar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
        }

        .navbar-brand {
            font-weight: bold;
            color: #2d5016 !important;
            font-size: 1.5rem;
        }

        .hero-section {
            background: linear-gradient(135deg, #2d5016 0%, #4a7c59 100%);
            color: white;
            padding: 60px 0;
            text-align: center;
        }

        .hero-title {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .hero-subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        /* Location Search Styles */
        .location-search-container {
            max-width: 600px;
            margin: 30px auto;
            position: relative;
        }

        .search-box {
            display: flex;
            align-items: center;
            background: white;
            border-radius: 50px;
            padding: 10px 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        .search-box:focus-within {
            transform: translateY(-2px);
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.3);
        }

        .search-box i {
            color: #4a7c59;
            margin-right: 10px;
            font-size: 1.2rem;
        }

        .search-box input {
            flex: 1;
            border: none;
            outline: none;
            font-size: 1.1rem;
            padding: 10px;
            color: #333;
        }

        .search-box input::placeholder {
            color: #999;
        }

        .search-box .btn {
            border-radius: 50px;
            padding: 8px 15px;
            margin-left: 10px;
        }

        .location-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            max-height: 300px;
            overflow-y: auto;
            display: none;
        }

        .location-suggestion {
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .location-suggestion:hover {
            background: #f8f9fa;
            color: #4a7c59;
        }

        .location-suggestion:last-child {
            border-bottom: none;
        }

        .suggestion-name {
            font-weight: 600;
            color: #333;
        }

        .suggestion-details {
            font-size: 0.9rem;
            color: #666;
        }

        .current-location-display {
            margin-top: 20px;
            padding: 15px 25px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 25px;
            display: inline-flex;
            align-items: center;
            gap: 15px;
            backdrop-filter: blur(10px);
        }

        .location-label {
            font-weight: 600;
        }

        .location-name {
            font-weight: 700;
            font-size: 1.1rem;
        }

        /* Crop Search Styles */
        .crop-search-container {
            max-width: 600px;
            margin: 0 auto;
            position: relative;
        }

        .crop-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            max-height: 300px;
            overflow-y: auto;
            display: none;
        }

        .crop-suggestion {
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .crop-suggestion:hover {
            background: #f8f9fa;
            color: #4a7c59;
        }

        .crop-suggestion:last-child {
            border-bottom: none;
        }

        .crop-suggestion-name {
            font-weight: 600;
            color: #333;
        }

        .crop-suggestion-details {
            font-size: 0.9rem;
            color: #666;
        }

        /* Crop Analysis Styles */
        .crop-analysis-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .crop-analysis-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #4a7c59;
        }

        .crop-analysis-card h5 {
            color: #2c5530;
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .analysis-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
        }

        .analysis-item {
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
            font-size: 0.95rem;
        }

        .analysis-item:last-child {
            border-bottom: none;
        }

        .analysis-item strong {
            color: #4a7c59;
            font-weight: 600;
        }

        /* Crops Grid Layout */
        .crops-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .crop-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #4a7c59;
            transition: all 0.3s ease;
            min-height: 400px;
            display: flex;
            flex-direction: column;
        }

        .crop-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .crop-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }

        .crop-header h5 {
            color: #2c5530;
            font-size: 1.3rem;
            font-weight: 700;
            margin: 0;
        }

        .crop-rank {
            background: #4a7c59;
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .profitability-score {
            background: #e8f5e8;
            color: #2c5530;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .crop-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .crop-info {
            margin-bottom: 15px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .info-item:last-child {
            border-bottom: none;
        }

        .info-label {
            font-weight: 600;
            color: #4a7c59;
            font-size: 0.95rem;
        }

        .info-value {
            font-weight: 500;
            color: #333;
            font-size: 0.95rem;
            text-align: right;
        }

        .crop-scores {
            margin-top: auto;
            padding-top: 15px;
            border-top: 2px solid #f0f0f0;
        }

        .score-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 0;
        }

        .score-label {
            font-weight: 600;
            color: #4a7c59;
            font-size: 0.9rem;
        }

        .score-value {
            font-weight: 500;
            color: #333;
            font-size: 0.9rem;
        }

        /* Universal Service Card Styles */
        .service-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .service-card-item {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #4a7c59;
            transition: all 0.3s ease;
            min-height: 350px;
            display: flex;
            flex-direction: column;
        }

        .service-card-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .service-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }

        .service-card-header h5 {
            color: #2c5530;
            font-size: 1.2rem;
            font-weight: 700;
            margin: 0;
        }

        .service-card-badge {
            background: #4a7c59;
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .service-card-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .service-card-info {
            margin-bottom: 15px;
        }

        .service-info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .service-info-item:last-child {
            border-bottom: none;
        }

        .service-info-label {
            font-weight: 600;
            color: #4a7c59;
            font-size: 0.95rem;
        }

        .service-info-value {
            font-weight: 500;
            color: #333;
            font-size: 0.95rem;
            text-align: right;
        }

        .service-card-actions {
            margin-top: auto;
            padding-top: 15px;
            border-top: 2px solid #f0f0f0;
        }

        .service-action-btn {
            background: #4a7c59;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-bottom: 8px;
        }

        .service-action-btn:hover {
            background: #2c5530;
            transform: translateY(-2px);
        }

        .service-action-btn.secondary {
            background: #e8f5e8;
            color: #2c5530;
        }

        .service-action-btn.secondary:hover {
            background: #d4edda;
        }

        /* Mandi Search Styles */
        .mandi-search-container {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid #dee2e6;
        }

        .mandi-search-container h5 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-weight: 600;
            text-align: center;
        }

        .search-boxes-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .search-box {
            background: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .search-box label {
            display: block;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .mandi-search-box,
        .crop-search-box {
            display: flex;
            gap: 10px;
        }

        .mandi-search-box input,
        .crop-search-box input {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .mandi-search-box input:focus,
        .crop-search-box input:focus {
            border-color: #007bff;
            outline: none;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
        }

        .mandi-search-box button {
            padding: 12px 20px;
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .crop-search-box button {
            padding: 12px 20px;
            background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mandi-search-box button:hover {
            background: linear-gradient(135deg, #0056b3 0%, #004085 100%);
            transform: translateY(-1px);
        }

        .crop-search-box button:hover {
            background: linear-gradient(135deg, #1e7e34 0%, #155724 100%);
            transform: translateY(-1px);
        }

        /* Mandi Dropdown and Crop Filter Styles */
        .mandi-selection-container {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .mandi-dropdown-container,
        .crop-filter-container {
            flex: 1;
            min-width: 250px;
        }

        .mandi-dropdown-container label,
        .crop-filter-container label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 14px;
        }

        .mandi-dropdown {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            background-color: white;
            transition: border-color 0.3s ease;
        }

        .mandi-dropdown:focus {
            border-color: #007bff;
            outline: none;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
        }

        .mandi-info-text {
            margin-top: 5px;
        }

        .mandi-info-text small {
            color: #6c757d;
            font-size: 12px;
        }

        #cropFilter {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        #cropFilter:focus {
            border-color: #28a745;
            outline: none;
            box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.1);
        }

        /* Mandi Prices Grid - Square Boxes */
        .mandi-prices-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .mandi-price-square {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border: 1px solid #e9ecef;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .mandi-price-square:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .square-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f8f9fa;
        }

        .square-header h6 {
            color: #2c3e50;
            font-weight: 600;
            margin: 0;
            font-size: 16px;
        }

        .trend-icon {
            font-size: 18px;
        }

        .square-content {
            text-align: center;
        }

        .price-main {
            margin-bottom: 15px;
        }

        .current-price {
            font-size: 24px;
            font-weight: 700;
            color: #28a745;
        }

        .price-unit {
            font-size: 14px;
            color: #6c757d;
            margin-left: 5px;
        }

        .price-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 0;
        }

        .detail-row .label {
            font-size: 12px;
            color: #6c757d;
            font-weight: 500;
        }

        .detail-row .value {
            font-size: 14px;
            font-weight: 600;
            color: #2c3e50;
        }

        .detail-row .value.profit {
            color: #28a745;
        }

        .detail-row .value.profit-percent {
            color: #28a745;
        }

        .mandi-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 10px;
            border-top: 1px solid #f8f9fa;
            font-size: 12px;
            color: #6c757d;
        }

        .mandi-name {
            font-weight: 600;
        }

        .mandi-results {
            margin-top: 15px;
        }

        /* Search Results Styles */
        .mandi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .mandi-summary-square {
            background: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            border: 1px solid #e9ecef;
            transition: transform 0.3s ease;
        }

        .mandi-summary-square:hover {
            transform: translateY(-2px);
        }

        .mandi-summary-square .square-header h6 {
            font-size: 14px;
            margin-bottom: 10px;
        }

        .mandi-summary-square .price-main {
            margin-bottom: 10px;
        }

        .mandi-summary-square .current-price {
            font-size: 18px;
        }

        .mandi-summary-square .mandi-name {
            font-size: 12px;
            margin-bottom: 5px;
        }

        .profit-info {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
        }

        .profit-info .profit {
            color: #28a745;
            font-weight: 600;
        }

        .profit-info .profit-percent {
            color: #28a745;
            font-weight: 600;
        }

        /* Crop Details Grid */
        .crop-details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .crop-detail-square {
            background: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            border: 1px solid #e9ecef;
            text-align: center;
        }

        .detail-label {
            font-size: 12px;
            color: #6c757d;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .detail-value {
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
        }

        .detail-value.profit {
            color: #28a745;
        }

        .detail-value.profit-percent {
            color: #28a745;
        }

        .crop-result-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border: 1px solid #e9ecef;
        }

        .crop-result-card h6 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-weight: 600;
            text-align: center;
        }

        /* Pest Analysis Styles */
        .pest-analysis-container {
            background: #fff;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
        }

        .analysis-header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }

        .analysis-header h4 {
            color: #2c5530;
            margin-bottom: 10px;
        }

        .image-analysis-result {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .analysis-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 10px;
            padding: 20px;
            border-left: 4px solid #28a745;
        }

        .analysis-card h5 {
            color: #2c5530;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .analysis-details {
            display: grid;
            gap: 10px;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #dee2e6;
        }

        .detail-item:last-child {
            border-bottom: none;
        }

        .detail-item .label {
            font-weight: 600;
            color: #495057;
        }

        .detail-item .value {
            font-weight: bold;
            color: #2c5530;
        }

        .detail-item .value.high {
            color: #dc3545;
        }

        .detail-item .value.severe {
            color: #dc3545;
            font-size: 1.1em;
        }

        .detail-item .value.moderate {
            color: #ffc107;
        }

        .detail-item .value.low {
            color: #28a745;
        }

        .treatment-recommendations {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            border-radius: 10px;
            padding: 20px;
            border-left: 4px solid #ffc107;
        }

        .treatment-recommendations h5 {
            color: #856404;
            margin-bottom: 15px;
        }

        .recommendations-grid {
            display: grid;
            gap: 15px;
        }

        .recommendation-card {
            background: #fff;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .recommendation-card h6 {
            color: #2c5530;
            margin-bottom: 10px;
        }

        .recommendation-card p {
            margin: 5px 0;
            color: #495057;
        }

        .pest-info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .pest-category,
        .disease-category {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 10px;
            padding: 20px;
        }

        .pest-category {
            border-left: 4px solid #17a2b8;
        }

        .disease-category {
            border-left: 4px solid #dc3545;
        }

        .pest-category h5,
        .disease-category h5 {
            margin-bottom: 15px;
            color: #2c5530;
        }

        .pest-item,
        .disease-item {
            background: #fff;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .pest-item h6,
        .disease-item h6 {
            color: #2c5530;
            margin-bottom: 10px;
        }

        .pest-item p,
        .disease-item p {
            margin: 5px 0;
            color: #495057;
        }

        /* Mobile Responsive for Pest Analysis */
        @media (max-width: 768px) {
            .image-analysis-result {
                grid-template-columns: 1fr;
            }

            .pest-info-grid {
                grid-template-columns: 1fr;
            }

            .analysis-details {
                gap: 8px;
            }

            .detail-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
        }

        .mandi-result-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border: 1px solid #e9ecef;
        }

        .mandi-result-card h6 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-weight: 600;
            font-size: 18px;
        }

        .mandi-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .mandi-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #f8f9fa;
        }

        .mandi-item .label {
            font-weight: 600;
            color: #495057;
        }

        .mandi-item .value {
            color: #2c3e50;
            font-weight: 500;
        }

        .mandi-analysis {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            display: flex;
            gap: 20px;
            justify-content: center;
        }

        .mandi-results-summary {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .mandi-results-summary h6 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .mandi-summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #f8f9fa;
        }

        .mandi-summary-item:last-child {
            border-bottom: none;
        }

        .crop-name {
            font-weight: 600;
            color: #2c3e50;
        }

        .crop-price {
            color: #28a745;
            font-weight: 600;
        }

        .crop-mandi {
            color: #6c757d;
            font-size: 14px;
        }

        .loading,
        .no-results,
        .error {
            text-align: center;
            padding: 20px;
            color: #6c757d;
            font-style: italic;
        }

        .error {
            color: #dc3545;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .search-boxes-container {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .mandi-search-box,
            .crop-search-box {
                flex-direction: column;
            }

            .mandi-prices-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .price-details {
                grid-template-columns: 1fr;
                gap: 8px;
            }

            .mandi-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .crop-details-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .mandi-info {
                flex-direction: column;
                gap: 5px;
                text-align: center;
            }

            .profit-info {
                flex-direction: column;
                gap: 5px;
                text-align: center;
            }
        }

        .services-container {
            padding: 60px 0;
            background: white;
        }

        .service-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            cursor: pointer !important;
            border: 2px solid transparent;
            pointer-events: auto !important;
            user-select: none;
        }

        .service-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            border-color: #4a7c59;
        }

        .service-card:active {
            transform: scale(0.95);
            transition: transform 0.1s ease;
        }

        .service-card * {
            pointer-events: auto;
        }

        .service-icon {
            font-size: 3rem;
            margin-bottom: 20px;
            color: #4a7c59;
        }

        .service-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #2d5016;
            margin-bottom: 15px;
        }

        .service-description {
            color: #666;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .service-button {
            background: linear-gradient(135deg, #4a7c59 0%, #2d5016 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .service-button:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(74, 124, 89, 0.4);
        }

        .content-section {
            display: none;
            padding: 40px 0;
            background: #f8f9fa;
        }

        .content-section.active {
            display: block;
        }

        .data-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .loading i {
            font-size: 2rem;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .status-indicator {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 12px;
            height: 12px;
            background: #28a745;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }

            100% {
                opacity: 1;
            }
        }

        /* Real-Time Data Display Styles */
        .real-time-header {
            background: linear-gradient(135deg, #2d5016 0%, #4a7c59 100%);
            color: white;
            padding: 25px 20px;
            border-radius: 15px;
            margin-bottom: 25px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(74, 124, 89, 0.3);
        }

        .real-time-header h4 {
            margin-bottom: 15px;
            font-size: 1.6rem;
            font-weight: 600;
        }

        .data-source,
        .timestamp,
        .reliability,
        .analysis-info,
        .scheme-count {
            font-size: 0.95rem;
            opacity: 0.9;
            margin: 8px 0;
            padding: 5px 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            display: inline-block;
        }

        .scheme-count {
            background: rgba(255, 255, 255, 0.2);
            font-weight: 600;
        }

        /* Scheme Card Styles */
        .scheme-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #4a7c59;
            transition: all 0.3s ease;
        }

        .scheme-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .scheme-card h5 {
            color: #2c5530;
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 15px;
            line-height: 1.4;
        }

        .scheme-card p {
            margin-bottom: 10px;
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .scheme-card strong {
            color: #4a7c59;
            font-weight: 600;
        }

        .scheme-actions {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .scheme-actions .btn {
            flex: 1;
            min-width: 120px;
            padding: 10px 15px;
            font-size: 0.9rem;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .scheme-actions .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .schemes-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .scheme-details {
            margin-bottom: 15px;
        }

        .scheme-card {
            animation: fadeInUp 0.6s ease-out forwards;
            opacity: 0;
            transform: translateY(20px);
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Mobile Responsive Styles */
        @media (max-width: 768px) {
            .real-time-header {
                padding: 20px 15px;
                margin-bottom: 20px;
            }

            .real-time-header h4 {
                font-size: 1.4rem;
                margin-bottom: 12px;
            }

            .data-source,
            .timestamp,
            .reliability,
            .analysis-info,
            .scheme-count {
                font-size: 0.85rem;
                margin: 6px 0;
                padding: 4px 8px;
            }

            .scheme-card {
                padding: 15px;
                margin-bottom: 15px;
            }

            .scheme-card h5 {
                font-size: 1.2rem;
                margin-bottom: 12px;
            }

            .scheme-card p {
                font-size: 0.9rem;
                margin-bottom: 8px;
            }

            .scheme-actions {
                margin-top: 15px;
                gap: 8px;
            }

            .scheme-actions .btn {
                padding: 8px 12px;
                font-size: 0.85rem;
                min-width: 100px;
            }

            .schemes-container {
                gap: 15px;
            }

            .container {
                padding: 0 15px;
            }
        }

        @media (max-width: 480px) {
            .real-time-header h4 {
                font-size: 1.2rem;
            }

            .scheme-card h5 {
                font-size: 1.1rem;
            }

            .scheme-actions {
                flex-direction: column;
            }

            .scheme-actions .btn {
                width: 100%;
                margin-bottom: 5px;
            }

            .schemes-container {
                gap: 12px;
            }

            .location-search-container {
                max-width: 100%;
                margin: 20px auto;
            }

            .search-box {
                padding: 8px 15px;
            }

            .search-box input {
                font-size: 1rem;
                padding: 8px;
            }

            .current-location-display {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }

            .crops-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .crop-card {
                min-height: 350px;
                padding: 15px;
            }

            .crop-header h5 {
                font-size: 1.1rem;
            }

            .service-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .service-card-item {
                min-height: 300px;
                padding: 15px;
            }

            .service-card-header h5 {
                font-size: 1.1rem;
            }
        }

        /* Crop Card Styles */
        .crop-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #4a7c59;
        }

        .crop-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .crop-header h5 {
            color: #2d5016;
            margin: 0;
        }

        .profitability-score {
            background: #4a7c59;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-weight: bold;
        }

        .crop-details {
            margin-bottom: 15px;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 5px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .detail-row .label {
            font-weight: bold;
            color: #666;
        }

        .detail-row .value {
            color: #2d5016;
            font-weight: 500;
        }

        .crop-scores {
            margin-top: 15px;
        }

        .score-item {
            margin-bottom: 10px;
        }

        .score-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 5px;
            display: block;
        }

        .score-bar {
            background: #f0f0f0;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 5px;
        }

        .score-fill {
            background: linear-gradient(90deg, #4a7c59, #2d5016);
            height: 100%;
            transition: width 0.3s ease;
        }

        .score-value {
            font-size: 0.8rem;
            color: #4a7c59;
            font-weight: bold;
        }

        /* Weather Card Styles */
        .weather-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .current-weather {
            margin-bottom: 20px;
        }

        .weather-main {
            text-align: center;
            margin-bottom: 15px;
        }

        .weather-temp {
            font-size: 2.5rem;
            font-weight: bold;
            color: #2d5016;
            margin: 10px 0;
        }

        .weather-condition {
            font-size: 1.2rem;
            color: #666;
        }

        .weather-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .detail-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .detail-item .icon {
            font-size: 1.2rem;
        }

        .detail-item .label {
            font-weight: bold;
            color: #666;
        }

        .detail-item .value {
            color: #2d5016;
            font-weight: 500;
        }

        .weather-forecast {
            margin-bottom: 20px;
        }

        .weather-forecast h6 {
            color: #2d5016;
            margin-bottom: 15px;
        }

        .forecast-day {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .farmer-advisory {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
        }

        .farmer-advisory h6 {
            color: #2d5016;
            margin-bottom: 10px;
        }

        .advisory-details {
            margin-top: 10px;
        }

        .advisory-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .advisory-item .icon {
            font-size: 1.1rem;
        }

        /* Price Card Styles */
        .price-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #4a7c59;
        }

        .price-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .price-header h5 {
            color: #2d5016;
            margin: 0;
        }

        .price-trend {
            font-size: 1.2rem;
        }

        .trend-up {
            color: #28a745;
        }

        .trend-down {
            color: #dc3545;
        }

        .trend-stable {
            color: #6c757d;
        }

        .price-details {
            margin-bottom: 15px;
        }

        .price-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 5px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .price-item .label {
            font-weight: bold;
            color: #666;
        }

        .price-item .value {
            color: #2d5016;
            font-weight: 500;
        }

        .current-price {
            color: #28a745 !important;
            font-weight: bold !important;
        }

        .msp-price {
            color: #007bff !important;
            font-weight: bold !important;
        }

        .price-analysis {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .analysis-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .analysis-label {
            font-weight: bold;
            color: #666;
        }

        .analysis-value {
            color: #28a745;
            font-weight: bold;
        }

        .chat-container {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 20px;
            background: white;
        }

        .message {
            margin-bottom: 15px;
            padding: 10px 15px;
            border-radius: 10px;
        }

        .user-message {
            background: #e3f2fd;
            margin-left: 20%;
        }

        .bot-message {
            background: #f1f8e9;
            margin-right: 20%;
        }

        .input-group {
            margin-top: 20px;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 5px;
            color: white;
            font-weight: bold;
            z-index: 1000;
            display: none;
        }

        .notification.success {
            background: #28a745;
        }

        .notification.error {
            background: #dc3545;
        }

        .notification.info {
            background: #17a2b8;
        }

        /* Weather UI Improvements */
        .weather-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .weather-temp {
            font-size: 3rem;
            font-weight: bold;
            color: #2d5016;
            margin: 10px 0;
        }

        .weather-condition {
            font-size: 1.2rem;
            color: #4a7c59;
            margin-bottom: 10px;
        }

        .weather-feels-like {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 15px;
        }

        .detail-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding: 8px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .detail-item:last-child {
            border-bottom: none;
        }

        .detail-item .icon {
            font-size: 1.2rem;
            margin-right: 10px;
            width: 25px;
        }

        .detail-item .label {
            font-weight: 500;
            margin-right: 10px;
            min-width: 100px;
        }

        .detail-item .value {
            font-weight: bold;
            color: #2d5016;
        }

        .forecast-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .forecast-item {
            text-align: center;
            padding: 15px;
            background: rgba(45, 80, 22, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(45, 80, 22, 0.2);
        }

        .forecast-day {
            font-weight: bold;
            color: #2d5016;
            margin-bottom: 8px;
        }

        .forecast-temp {
            font-size: 1.1rem;
            font-weight: bold;
            color: #4a7c59;
            margin-bottom: 5px;
        }

        .forecast-condition {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 5px;
        }

        .forecast-humidity,
        .forecast-wind {
            font-size: 0.8rem;
            color: #888;
        }

        .agricultural-advice {
            background: rgba(74, 124, 89, 0.1);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #4a7c59;
        }

        .agricultural-advice p {
            margin: 0;
            color: #2d5016;
            line-height: 1.6;
        }

        .real-time-header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(45, 80, 22, 0.2);
        }

        .real-time-header h4 {
            color: #2d5016;
            margin-bottom: 10px;
        }

        .data-source {
            font-size: 0.9rem;
            color: #4a7c59;
            margin: 5px 0;
        }

        .timestamp {
            font-size: 0.8rem;
            color: #666;
            margin: 5px 0;
        }
    </style>
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light">
        <div class="container">
            <a class="navbar-brand" href="#">
                üåæ ‡§ï‡•É‡§∑‡§ø‡§Æ‡§ø‡§§‡•ç‡§∞ AI
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showService('home')">‡§π‡•ã‡§Æ</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showService('government-schemes')">‡§Ø‡•ã‡§ú‡§®‡§æ‡§è‡§Ç</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showService('ai-assistant')">AI ‡§∏‡§π‡§æ‡§Ø‡§ï</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <div class="hero-section">
        <div class="container">
            <h1 class="hero-title">üåæ ‡§ï‡•É‡§∑‡§ø‡§Æ‡§ø‡§§‡•ç‡§∞ AI</h1>
            <p class="hero-subtitle">‡§ï‡§ø‡§∏‡§æ‡§®‡•ã‡§Ç ‡§ï‡§æ ‡§∏‡§¨‡§∏‡•á ‡§Ö‡§ö‡•ç‡§õ‡§æ ‡§¶‡•ã‡§∏‡•ç‡§§ - AI ‡§∏‡•á ‡§∏‡•ç‡§Æ‡§æ‡§∞‡•ç‡§ü ‡§ñ‡•á‡§§‡•Ä ‡§ï‡§∞‡•á‡§Ç</p>

            <!-- Location Search Bar -->
            <div class="location-search-container">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="locationSearchInput" placeholder="‡§∂‡§π‡§∞, ‡§ú‡§ø‡§≤‡§æ ‡§Ø‡§æ ‡§ó‡§æ‡§Å‡§µ ‡§ñ‡•ã‡§ú‡•á‡§Ç..."
                        onkeyup="searchLocations(event)" onfocus="showLocationSuggestions()">
                    <button class="btn btn-primary" onclick="searchCurrentLocation()">
                        <i class="fas fa-map-marker-alt"></i>
                    </button>
                </div>
                <div id="locationSuggestions" class="location-suggestions"></div>
            </div>

            <div class="current-location-display">
                <span class="location-label">üìç ‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§∏‡•ç‡§•‡§æ‡§®:</span>
                <span id="currentLocationDisplay" class="location-name">Delhi</span>
                <button class="btn btn-sm btn-outline-light" onclick="detectLocation()">
                    <i class="fas fa-crosshairs"></i> ‡§∏‡•ç‡§•‡§æ‡§® ‡§™‡§§‡§æ ‡§ï‡§∞‡•á‡§Ç
                </button>
            </div>
        </div>
    </div>

    <!-- Services Section -->
    <div class="services-container">
        <div class="container">
            <h2 class="text-center mb-2" style="color: #2d5016;">‡§ï‡§ø‡§∏‡§æ‡§®‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§∏‡•á‡§µ‡§æ‡§è‡§Ç</h2>
            <p class="text-center mb-5" style="color: #666; font-size: 1rem;">üåæ AI-Powered ‚Ä¢ Real-Time Data ‚Ä¢
                Government APIs</p>

            <!-- Quick Stats Bar -->
            <div
                style="background: linear-gradient(135deg, #2d5016 0%, #4a7c59 100%); border-radius: 15px; padding: 20px 30px; margin-bottom: 35px; display: flex; flex-wrap: wrap; gap: 20px; justify-content: space-around; color: white;">
                <div style="text-align:center;">
                    <div style="font-size: 1.8rem; font-weight: 800;">‚Çπ2,275</div>
                    <div style="font-size: 0.85rem; opacity: 0.9;">‡§ó‡•á‡§π‡•Ç‡§Å MSP 2024-25</div>
                </div>
                <div style="text-align:center;">
                    <div style="font-size: 1.8rem; font-weight: 800;">‚Çπ2,300</div>
                    <div style="font-size: 0.85rem; opacity: 0.9;">‡§ß‡§æ‡§® MSP 2024-25</div>
                </div>
                <div style="text-align:center;">
                    <div style="font-size: 1.8rem; font-weight: 800;">‚Çπ6,000</div>
                    <div style="font-size: 0.85rem; opacity: 0.9;">PM-Kisan ‡§µ‡§æ‡§∞‡•ç‡§∑‡§ø‡§ï</div>
                </div>
                <div style="text-align:center;">
                    <div style="font-size: 1.8rem; font-weight: 800;">4%</div>
                    <div style="font-size: 0.85rem; opacity: 0.9;">KCC ‡§¨‡•ç‡§Ø‡§æ‡§ú ‡§¶‡§∞</div>
                </div>
                <div style="text-align:center;">
                    <div style="font-size: 1.8rem; font-weight: 800;">90%</div>
                    <div style="font-size: 0.85rem; opacity: 0.9;">‡§∏‡•ã‡§≤‡§∞ ‡§™‡§Ç‡§™ ‡§∏‡§¨‡•ç‡§∏‡§ø‡§°‡•Ä</div>
                </div>
            </div>

            <div class="row">
                <!-- Government Schemes -->
                <div class="col-lg-4 col-md-6 mb-4">
                    <div class="service-card" onclick="showService('government-schemes')">
                        <div class="status-indicator"></div>
                        <div class="service-icon">üèõÔ∏è</div>
                        <h3 class="service-title">‡§∏‡§∞‡§ï‡§æ‡§∞‡•Ä ‡§Ø‡•ã‡§ú‡§®‡§æ‡§è‡§Ç</h3>
                        <p class="service-description">‡§ï‡•á‡§Ç‡§¶‡•ç‡§∞ ‡§î‡§∞ ‡§∞‡§æ‡§ú‡•ç‡§Ø ‡§∏‡§∞‡§ï‡§æ‡§∞ ‡§ï‡•Ä ‡§ï‡•É‡§∑‡§ø ‡§Ø‡•ã‡§ú‡§®‡§æ‡§è‡§Ç</p>
                        <div
                            style="background: #f8fff8; border-radius: 10px; padding: 12px; margin: 12px 0; font-size: 0.88rem;">
                            <div style="color: #2d5016; margin-bottom: 5px;"><strong>üìå ‡§™‡•ç‡§∞‡§Æ‡•Å‡§ñ ‡§Ø‡•ã‡§ú‡§®‡§æ‡§è‡§Ç:</strong></div>
                            <div style="color: #444; line-height: 1.7;">
                                üåæ PM-Kisan: <strong>‚Çπ6,000/‡§µ‡§∞‡•ç‡§∑</strong><br>
                                üõ°Ô∏è PMFBY: <strong>2% ‡§™‡•ç‡§∞‡•Ä‡§Æ‡§ø‡§Ø‡§Æ</strong> ‡§™‡§∞ ‡§¨‡•Ä‡§Æ‡§æ<br>
                                üí≥ KCC: <strong>‚Çπ3L ‡§ã‡§£ @4%</strong><br>
                                ‚òÄÔ∏è PM-KUSUM: <strong>90% ‡§∏‡§¨‡•ç‡§∏‡§ø‡§°‡•Ä</strong>
                            </div>
                        </div>
                        <button class="service-button">‡§Ø‡•ã‡§ú‡§®‡§æ‡§è‡§Ç ‡§¶‡•á‡§ñ‡•á‡§Ç</button>
                    </div>
                </div>

                <!-- Crop Recommendations -->
                <div class="col-lg-4 col-md-6 mb-4">
                    <div class="service-card" onclick="showService('crop-recommendations')">
                        <div class="status-indicator"></div>
                        <div class="service-icon">üåæ</div>
                        <h3 class="service-title">‡§´‡§∏‡§≤ ‡§∏‡•Å‡§ù‡§æ‡§µ</h3>
                        <p class="service-description">AI ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§Ü‡§™‡§ï‡•á ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡§∞‡•ç‡§µ‡•ã‡§§‡•ç‡§§‡§Æ ‡§´‡§∏‡§≤‡•á‡§Ç</p>
                        <div
                            style="background: #f8fff8; border-radius: 10px; padding: 12px; margin: 12px 0; font-size: 0.88rem;">
                            <div style="color: #2d5016; margin-bottom: 5px;"><strong>üå± ‡§∞‡§¨‡•Ä ‡§∏‡•Ä‡§ú‡§®
                                    (‡§Ö‡§ï‡•ç‡§ü‡•Ç‡§¨‡§∞‚Äì‡§Æ‡§æ‡§∞‡•ç‡§ö):</strong></div>
                            <div style="color: #444; line-height: 1.7;">
                                üåæ ‡§ó‡•á‡§π‡•Ç‡§Å ‚Äî MSP ‚Çπ2,275/‡§ï‡•ç‡§µ‡§ø‡§Ç‡§ü‡§≤<br>
                                üåº ‡§∏‡§∞‡§∏‡•ã‡§Ç ‚Äî MSP ‚Çπ5,650/‡§ï‡•ç‡§µ‡§ø‡§Ç‡§ü‡§≤<br>
                                ü´ò ‡§ö‡§®‡§æ ‚Äî MSP ‚Çπ5,440/‡§ï‡•ç‡§µ‡§ø‡§Ç‡§ü‡§≤<br>
                                üåø ‡§Æ‡§∏‡•Ç‡§∞ ‚Äî MSP ‚Çπ6,425/‡§ï‡•ç‡§µ‡§ø‡§Ç‡§ü‡§≤
                            </div>
                        </div>
                        <button class="service-button">‡§´‡§∏‡§≤ ‡§∏‡•Å‡§ù‡§æ‡§µ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡•á‡§Ç</button>
                    </div>
                </div>

                <!-- Weather -->
                <div class="col-lg-4 col-md-6 mb-4">
                    <div class="service-card" onclick="showService('weather')">
                        <div class="status-indicator"></div>
                        <div class="service-icon">üå§Ô∏è</div>
                        <h3 class="service-title">‡§Æ‡•å‡§∏‡§Æ ‡§™‡•Ç‡§∞‡•ç‡§µ‡§æ‡§®‡•Å‡§Æ‡§æ‡§®</h3>
                        <p class="service-description">7 ‡§¶‡§ø‡§® ‡§ï‡§æ ‡§µ‡§ø‡§∏‡•ç‡§§‡•É‡§§ ‡§Æ‡•å‡§∏‡§Æ ‡§™‡•Ç‡§∞‡•ç‡§µ‡§æ‡§®‡•Å‡§Æ‡§æ‡§®</p>
                        <div
                            style="background: #f0f8ff; border-radius: 10px; padding: 12px; margin: 12px 0; font-size: 0.88rem;">
                            <div style="color: #1a5276; margin-bottom: 5px;"><strong>üåæ ‡§Æ‡•å‡§∏‡§Æ-‡§ï‡•É‡§∑‡§ø ‡§∏‡§≤‡§æ‡§π:</strong></div>
                            <div style="color: #444; line-height: 1.7;">
                                üî• ‡§≤‡•Ç (40¬∞C+): ‡§∏‡•Å‡§¨‡§π/‡§∂‡§æ‡§Æ ‡§∏‡•Ä‡§Ç‡§ö‡•á‡§Ç<br>
                                üåßÔ∏è ‡§≠‡§æ‡§∞‡•Ä ‡§¨‡§æ‡§∞‡§ø‡§∂: ‡§ú‡§≤ ‡§®‡§ø‡§ï‡§æ‡§∏‡•Ä ‡§ï‡§∞‡•á‡§Ç<br>
                                ‚ùÑÔ∏è ‡§™‡§æ‡§≤‡§æ (5¬∞C-): ‡§´‡§∏‡§≤ ‡§¢‡§ï‡•á‡§Ç<br>
                                üì± IMD App: Meghdoot
                            </div>
                        </div>
                        <button class="service-button">‡§Æ‡•å‡§∏‡§Æ ‡§¶‡•á‡§ñ‡•á‡§Ç</button>
                    </div>
                </div>

                <!-- Market Prices -->
                <div class="col-lg-4 col-md-6 mb-4">
                    <div class="service-card" onclick="showService('market-prices')">
                        <div class="status-indicator"></div>
                        <div class="service-icon">üí∞</div>
                        <h3 class="service-title">‡§¨‡§æ‡§ú‡§æ‡§∞ ‡§ï‡•Ä‡§Æ‡§§‡•á‡§Ç</h3>
                        <p class="service-description">Agmarknet/eNAM ‡§∏‡•á ‡§∞‡§ø‡§Ø‡§≤-‡§ü‡§æ‡§á‡§Æ ‡§Æ‡§Ç‡§°‡•Ä ‡§≠‡§æ‡§µ</p>
                        <div
                            style="background: #fffdf0; border-radius: 10px; padding: 12px; margin: 12px 0; font-size: 0.88rem;">
                            <div style="color: #7d6608; margin-bottom: 5px;"><strong>üìä MSP 2024-25:</strong></div>
                            <div style="color: #444; line-height: 1.7;">
                                üåæ ‡§ó‡•á‡§π‡•Ç‡§Å: <strong>‚Çπ2,275</strong>/‡§ï‡•ç‡§µ‡§ø‡§Ç‡§ü‡§≤<br>
                                üçö ‡§ö‡§æ‡§µ‡§≤: <strong>‚Çπ2,300</strong>/‡§ï‡•ç‡§µ‡§ø‡§Ç‡§ü‡§≤<br>
                                üåª ‡§∏‡•ã‡§Ø‡§æ‡§¨‡•Ä‡§®: <strong>‚Çπ4,892</strong>/‡§ï‡•ç‡§µ‡§ø‡§Ç‡§ü‡§≤<br>
                                üåø ‡§ï‡§™‡§æ‡§∏: <strong>‚Çπ7,121</strong>/‡§ï‡•ç‡§µ‡§ø‡§Ç‡§ü‡§≤
                            </div>
                        </div>
                        <button class="service-button">‡§ï‡•Ä‡§Æ‡§§‡•á‡§Ç ‡§¶‡•á‡§ñ‡•á‡§Ç</button>
                    </div>
                </div>

                <!-- Pest Control -->
                <div class="col-lg-4 col-md-6 mb-4">
                    <div class="service-card" onclick="showService('pest-control')">
                        <div class="status-indicator"></div>
                        <div class="service-icon">üêõ</div>
                        <h3 class="service-title">KrishiRaksha ‚Äî ‡§´‡§∏‡§≤ ‡§∞‡§ï‡•ç‡§∑‡§æ</h3>
                        <p class="service-description">AI ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§ï‡•Ä‡§ü-‡§∞‡•ã‡§ó ‡§ï‡•Ä ‡§™‡§π‡§ö‡§æ‡§® ‡§µ ‡§â‡§™‡§ö‡§æ‡§∞</p>
                        <div
                            style="background: #fff8f8; border-radius: 10px; padding: 12px; margin: 12px 0; font-size: 0.88rem;">
                            <div style="color: #c0392b; margin-bottom: 5px;"><strong>üî¨ ‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§ï‡•Ä‡§ü-‡§∞‡•ã‡§ó:</strong></div>
                            <div style="color: #444; line-height: 1.7;">
                                üêõ ‡§Æ‡§æ‡§π‡•Ç: Imidacloprid ‡§∏‡•á ‡§®‡§ø‡§Ø‡§Ç‡§§‡•ç‡§∞‡§£<br>
                                ü¶† ‡§ù‡•Å‡§≤‡§∏‡§æ: Metalaxyl ‡§â‡§™‡§ö‡§æ‡§∞<br>
                                üåø ‡§®‡•Ä‡§Æ ‡§§‡•á‡§≤: ‡§ú‡•à‡§µ‡§ø‡§ï ‡§µ‡§ø‡§ï‡§≤‡•ç‡§™<br>
                                üìû ICAR: 1800-180-1551
                            </div>
                        </div>
                        <button class="service-button">‡§ú‡§æ‡§Ç‡§ö ‡§ï‡§∞‡•á‡§Ç</button>
                    </div>
                </div>

                <!-- AI Assistant -->
                <div class="col-lg-4 col-md-6 mb-4">
                    <div class="service-card" onclick="showService('ai-assistant')">
                        <div class="status-indicator"></div>
                        <div class="service-icon">ü§ñ</div>
                        <h3 class="service-title">AI ‡§∏‡§π‡§æ‡§Ø‡§ï</h3>
                        <p class="service-description">24/7 ‡§ï‡•É‡§∑‡§ø ‡§µ‡§ø‡§∂‡•á‡§∑‡§ú‡•ç‡§û ‚Äî ‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§Æ‡•á‡§Ç ‡§¨‡§æ‡§§ ‡§ï‡§∞‡•á‡§Ç</p>
                        <div
                            style="background: #f3f0ff; border-radius: 10px; padding: 12px; margin: 12px 0; font-size: 0.88rem;">
                            <div style="color: #5b2c6f; margin-bottom: 5px;"><strong>üí¨ ‡§™‡•Ç‡§õ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç:</strong></div>
                            <div style="color: #444; line-height: 1.7;">
                                üåæ "‡§ó‡•á‡§π‡•Ç‡§Å ‡§ï‡§¨ ‡§¨‡•ã‡§è‡§Ç?"<br>
                                üí∞ "PM-Kisan status ‡§ï‡•à‡§∏‡•á ‡§¶‡•á‡§ñ‡•á‡§Ç?"<br>
                                üêõ "‡§ü‡§Æ‡§æ‡§ü‡§∞ ‡§Æ‡•á‡§Ç ‡§∞‡•ã‡§ó ‡§ï‡•ç‡§Ø‡•ã‡§Ç?"<br>
                                üå§Ô∏è "‡§Ü‡§ú ‡§ñ‡•á‡§§ ‡§Æ‡•á‡§Ç ‡§ï‡•ç‡§Ø‡§æ ‡§ï‡§∞‡•á‡§Ç?"
                            </div>
                        </div>
                        <button class="service-button">‡§¨‡§æ‡§§ ‡§ï‡§∞‡•á‡§Ç</button>
                    </div>
                </div>
            </div>

            <!-- Farming Calendar Section -->
            <div
                style="background: white; border-radius: 15px; padding: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); margin-top: 10px; margin-bottom: 30px;">
                <h4 style="color: #2d5016; margin-bottom: 20px; text-align: center;">üìÖ ‡§ï‡•É‡§∑‡§ø ‡§ï‡•à‡§≤‡•á‡§Ç‡§°‡§∞ 2025-26</h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div
                        style="background: #fff3cd; border-radius: 10px; padding: 15px; border-left: 4px solid #ffc107;">
                        <strong style="color: #856404;">‚òÄÔ∏è ‡§ñ‡§∞‡•Ä‡§´ (‡§ú‡•Ç‡§®-‡§®‡§µ‡§Ç‡§¨‡§∞)</strong>
                        <ul
                            style="margin: 8px 0 0 0; padding-left: 18px; color: #444; font-size: 0.9rem; line-height: 1.8;">
                            <li>‡§ß‡§æ‡§® ‚Äî ‡§ú‡•Ç‡§®-‡§ú‡•Å‡§≤‡§æ‡§à ‡§¨‡•Å‡§µ‡§æ‡§à</li>
                            <li>‡§Æ‡§ï‡•ç‡§ï‡§æ ‚Äî ‡§ú‡•Ç‡§® ‡§¨‡•Å‡§µ‡§æ‡§à</li>
                            <li>‡§∏‡•ã‡§Ø‡§æ‡§¨‡•Ä‡§® ‚Äî ‡§ú‡•Å‡§≤‡§æ‡§à ‡§¨‡•Å‡§µ‡§æ‡§à</li>
                            <li>‡§ï‡§™‡§æ‡§∏ ‚Äî ‡§Æ‡§à-‡§ú‡•Ç‡§® ‡§¨‡•Å‡§µ‡§æ‡§à</li>
                        </ul>
                    </div>
                    <div
                        style="background: #d1ecf1; border-radius: 10px; padding: 15px; border-left: 4px solid #17a2b8;">
                        <strong style="color: #0c5460;">‚ùÑÔ∏è ‡§∞‡§¨‡•Ä (‡§Ö‡§ï‡•ç‡§ü‡•Ç‡§¨‡§∞-‡§Æ‡§æ‡§∞‡•ç‡§ö)</strong>
                        <ul
                            style="margin: 8px 0 0 0; padding-left: 18px; color: #444; font-size: 0.9rem; line-height: 1.8;">
                            <li>‡§ó‡•á‡§π‡•Ç‡§Å ‚Äî ‡§®‡§µ‡§Ç‡§¨‡§∞ ‡§¨‡•Å‡§µ‡§æ‡§à</li>
                            <li>‡§∏‡§∞‡§∏‡•ã‡§Ç ‚Äî ‡§Ö‡§ï‡•ç‡§ü‡•Ç‡§¨‡§∞ ‡§¨‡•Å‡§µ‡§æ‡§à</li>
                            <li>‡§ö‡§®‡§æ ‚Äî ‡§®‡§µ‡§Ç‡§¨‡§∞ ‡§¨‡•Å‡§µ‡§æ‡§à</li>
                            <li>‡§Æ‡§ü‡§∞ ‚Äî ‡§Ö‡§ï‡•ç‡§ü‡•Ç‡§¨‡§∞ ‡§¨‡•Å‡§µ‡§æ‡§à</li>
                        </ul>
                    </div>
                    <div
                        style="background: #d4edda; border-radius: 10px; padding: 15px; border-left: 4px solid #28a745;">
                        <strong style="color: #155724;">üå∏ ‡§ú‡§æ‡§Ø‡§¶ (‡§Æ‡§æ‡§∞‡•ç‡§ö-‡§ú‡•Ç‡§®)</strong>
                        <ul
                            style="margin: 8px 0 0 0; padding-left: 18px; color: #444; font-size: 0.9rem; line-height: 1.8;">
                            <li>‡§Æ‡•Ç‡§Ç‡§ó ‚Äî ‡§Æ‡§æ‡§∞‡•ç‡§ö ‡§¨‡•Å‡§µ‡§æ‡§à</li>
                            <li>‡§§‡§∞‡§¨‡•Ç‡§ú ‚Äî ‡§´‡§∞‡§µ‡§∞‡•Ä-‡§Æ‡§æ‡§∞‡•ç‡§ö</li>
                            <li>‡§ñ‡•Ä‡§∞‡§æ ‚Äî ‡§Æ‡§æ‡§∞‡•ç‡§ö ‡§¨‡•Å‡§µ‡§æ‡§à</li>
                            <li>‡§≠‡§ø‡§Ç‡§°‡•Ä ‚Äî ‡§Æ‡§æ‡§∞‡•ç‡§ö-‡§Ö‡§™‡•ç‡§∞‡•à‡§≤</li>
                        </ul>
                    </div>
                    <div
                        style="background: #f8d7da; border-radius: 10px; padding: 15px; border-left: 4px solid #dc3545;">
                        <strong style="color: #721c24;">üìû ‡§π‡•á‡§≤‡•ç‡§™‡§≤‡§æ‡§á‡§® ‡§®‡§Ç‡§¨‡§∞</strong>
                        <ul
                            style="margin: 8px 0 0 0; padding-left: 18px; color: #444; font-size: 0.9rem; line-height: 1.8;">
                            <li>Kisan: <strong>1800-180-1551</strong></li>
                            <li>PM-Kisan: <strong>155261</strong></li>
                            <li>NABARD: <strong>1800-200-1025</strong></li>
                            <li>eNAM: <strong>1800-270-0224</strong></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Content Sections -->
    <div class="content-section" id="government-schemes-content">
        <div class="container">
            <h2 class="text-center mb-4">üèõÔ∏è ‡§∏‡§∞‡§ï‡§æ‡§∞‡•Ä ‡§Ø‡•ã‡§ú‡§®‡§æ‡§è‡§Ç</h2>
            <div id="schemesData" class="loading">
                <i class="fas fa-spinner"></i>
                <p>‡§Ø‡•ã‡§ú‡§®‡§æ‡§è‡§Ç ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡•Ä ‡§π‡•à‡§Ç...</p>
            </div>
        </div>
    </div>

    <div class="content-section" id="crop-recommendations-content">
        <div class="container">
            <h2 class="text-center mb-4">üåæ ‡§´‡§∏‡§≤ ‡§∏‡•Å‡§ù‡§æ‡§µ</h2>

            <!-- Crop Search Bar -->
            <div class="crop-search-container mb-4">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="cropSearchInput" placeholder="‡§´‡§∏‡§≤ ‡§ñ‡•ã‡§ú‡•á‡§Ç (‡§ú‡•à‡§∏‡•á: ‡§ó‡•á‡§π‡•Ç‡§Ç, ‡§ß‡§æ‡§®, ‡§Æ‡§ï‡•ç‡§ï‡§æ)..."
                        onkeyup="searchCrop(event)" onfocus="showCropSuggestions()">
                    <button class="btn btn-primary" onclick="searchSpecificCrop()">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
                <div id="cropSuggestions" class="crop-suggestions"></div>
            </div>

            <div id="cropsData" class="loading">
                <i class="fas fa-spinner"></i>
                <p>‡§´‡§∏‡§≤ ‡§∏‡•Å‡§ù‡§æ‡§µ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡•á ‡§π‡•à‡§Ç...</p>
            </div>
        </div>
    </div>

    <div class="content-section" id="weather-content">
        <div class="container">
            <h2 class="text-center mb-4">üå§Ô∏è ‡§Æ‡•å‡§∏‡§Æ ‡§™‡•Ç‡§∞‡•ç‡§µ‡§æ‡§®‡•Å‡§Æ‡§æ‡§®</h2>
            <div id="weatherData" class="loading">
                <i class="fas fa-spinner"></i>
                <p>‡§Æ‡•å‡§∏‡§Æ ‡§ï‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡•Ä ‡§π‡•à...</p>
            </div>
        </div>
    </div>

    <div class="content-section" id="market-prices-content">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2 class="mb-0">üí∞ ‡§¨‡§æ‡§ú‡§æ‡§∞ ‡§ï‡•Ä‡§Æ‡§§‡•á‡§Ç</h2>
                <button onclick="forceReloadMarketPrices()" class="btn btn-outline-primary btn-sm">
                    <i class="fas fa-sync-alt"></i> ‡§∞‡§ø‡§´‡•ç‡§∞‡•á‡§∂ ‡§ï‡§∞‡•á‡§Ç
                </button>
            </div>

            <!-- Mandi Selector -->
            <div
                style="background:#f0f8f0;border:1px solid #d4edda;border-radius:12px;padding:14px 18px;margin-bottom:18px;display:flex;align-items:center;gap:12px;flex-wrap:wrap;">
                <label style="font-weight:600;color:#2d5016;margin:0;white-space:nowrap;">üè™ ‡§Æ‡§Ç‡§°‡•Ä ‡§ö‡•Å‡§®‡•á‡§Ç:</label>
                <select id="mandiSelector" onchange="onMandiSelected(this.value)"
                    style="flex:1;min-width:200px;padding:8px 12px;border-radius:8px;border:1.5px solid #4a7c59;font-size:0.95rem;color:#2d5016;background:white;cursor:pointer;">
                    <option value="">-- ‡§∏‡§≠‡•Ä ‡§Æ‡§Ç‡§°‡§ø‡§Ø‡§æ‡§Ç (All Mandis) --</option>
                </select>
                <span id="mandiStatusBadge" style="font-size:0.82rem;color:#666;"></span>
            </div>

            <div id="pricesData" class="loading">
                <i class="fas fa-spinner"></i>
                <p>‡§¨‡§æ‡§ú‡§æ‡§∞ ‡§ï‡•Ä‡§Æ‡§§‡•á‡§Ç ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡•Ä ‡§π‡•à‡§Ç...</p>
            </div>
        </div>
    </div>

    <div class="content-section" id="pest-control-content">
        <div class="container">
            <h2 class="text-center mb-4">ü©∫ KrishiRaksha 2.0: Advanced Diagnostics</h2>

            <!-- Step 1: Crop Selection -->
            <div class="card mb-4 shadow-sm">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0"><i class="fas fa-seedling"></i> Step 1: Select Your Crop (‡§´‡§∏‡§≤ ‡§ö‡•Å‡§®‡•á‡§Ç)</h5>
                </div>
                <div class="card-body">
                    <select class="form-select form-select-lg" id="krCropSelect">
                        <option value="">-- Choose Crop / ‡§´‡§∏‡§≤ ‡§ö‡•Å‡§®‡•á‡§Ç --</option>
                        <option value="tomato">Tomato (‡§ü‡§Æ‡§æ‡§ü‡§∞)</option>
                        <option value="rice">Rice (‡§ß‡§æ‡§®)</option>
                        <option value="potato">Potato (‡§Ü‡§≤‡•Ç)</option>
                        <option value="banana">Banana (‡§ï‡•á‡§≤‡§æ)</option>
                        <option value="chilli">Chilli (‡§Æ‡§ø‡§∞‡•ç‡§ö)</option>
                        <option value="other">Other (‡§Ö‡§®‡•ç‡§Ø)</option>
                    </select>
                </div>
            </div>

            <!-- Step 2: Multi-Image Upload -->
            <div class="card mb-4 shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-camera"></i> Step 2: Multi-Angle Analysis (‡§§‡§∏‡•ç‡§µ‡•Ä‡§∞‡•á‡§Ç ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç)
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-4">
                            <div class="upload-box text-center p-3 border rounded bg-light h-100">
                                <i class="fas fa-tree fa-2x text-success mb-2"></i>
                                <h6>Whole Plant (‡§™‡•Ç‡§∞‡•Ä ‡§´‡§∏‡§≤)</h6>
                                <input type="file" id="imgWhole" class="form-control mb-2" accept="image/*">
                                <small class="text-muted d-block">Take a photo from 5-10ft away</small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="upload-box text-center p-3 border rounded bg-light h-100">
                                <i class="fas fa-search-plus fa-2x text-danger mb-2"></i>
                                <h6>Affected Part (‡§®‡§ú‡§¶‡•Ä‡§ï ‡§∏‡•á)</h6>
                                <input type="file" id="imgCloseUp" class="form-control mb-2" accept="image/*">
                                <small class="text-muted d-block">Zoom in on the disease/pest</small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="upload-box text-center p-3 border rounded bg-light h-100">
                                <i class="fas fa-leaf fa-2x text-warning mb-2"></i>
                                <h6>Leaf Texture (‡§™‡§§‡•ç‡§§‡•Ä ‡§ï‡§æ ‡§™‡•à‡§ü‡§∞‡•ç‡§®)</h6>
                                <input type="file" id="imgLeaf" class="form-control mb-2" accept="image/*">
                                <small class="text-muted d-block">Clear photo of leaf veins/spots</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action -->
            <div class="text-center mb-5">
                <button class="btn btn-lg btn-danger px-5 py-3 rounded-pill shadow"
                    onclick="runKrishiRakshaDiagnosis()">
                    <i class="fas fa-microscope fa-lg"></i> Run Diagnosis (‡§ú‡§æ‡§Ç‡§ö ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç)
                </button>
            </div>

            <!-- Results Container -->
            <div id="krishiRakshaResults" style="display:none;" class="animated-result">
                <div class="text-center p-5">
                    <i class="fas fa-spinner fa-spin fa-3x text-success"></i>
                    <h4 class="mt-3">Analyzing Crop Health...</h4>
                    <p>Checking 150+ Diseases ‚Ä¢ Verifying with Weather Data...</p>
                </div>
            </div>
        </div>
    </div>

    <div class="content-section" id="ai-assistant-content">
        <div class="container">
            <h2 class="text-center mb-2">ü§ñ KrishiMitra AI ‡§∏‡§π‡§æ‡§Ø‡§ï</h2>
            <p class="text-center text-muted mb-4">‡§π‡§ø‡§Ç‡§¶‡•Ä, English ‡§Ø‡§æ Hinglish ‡§Æ‡•á‡§Ç ‡§™‡•Ç‡§õ‡•á‡§Ç ‚Äî 24/7 ‡§â‡§™‡§≤‡§¨‡•ç‡§ß</p>

            <!-- Suggested Questions -->
            <div id="suggestedQuestions" style="margin-bottom: 20px;">
                <div style="font-weight: 600; color: #2d5016; margin-bottom: 12px; font-size: 0.95rem;">üí° ‡§Ö‡§ï‡•ç‡§∏‡§∞ ‡§™‡•Ç‡§õ‡•á
                    ‡§ú‡§æ‡§®‡•á ‡§µ‡§æ‡§≤‡•á ‡§∏‡§µ‡§æ‡§≤:</div>
                <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                    <button onclick="askSuggested('‡§ó‡•á‡§π‡•Ç‡§Å ‡§ï‡•Ä ‡§¨‡•Å‡§µ‡§æ‡§à ‡§ï‡§æ ‡§∏‡§π‡•Ä ‡§∏‡§Æ‡§Ø ‡§î‡§∞ ‡§§‡§∞‡•Ä‡§ï‡§æ ‡§¨‡§§‡§æ‡§è‡§Ç')"
                        style="background:#e8f5e8; border:1px solid #4a7c59; color:#2d5016; padding:6px 14px; border-radius:20px; font-size:0.85rem; cursor:pointer; transition:all 0.2s;"
                        onmouseover="this.style.background='#4a7c59';this.style.color='white'"
                        onmouseout="this.style.background='#e8f5e8';this.style.color='#2d5016'">
                        üåæ ‡§ó‡•á‡§π‡•Ç‡§Å ‡§¨‡•Å‡§µ‡§æ‡§à ‡§ï‡§¨?
                    </button>
                    <button onclick="askSuggested('PM-Kisan ‡§ï‡§æ ‡§™‡•à‡§∏‡§æ ‡§ï‡§¨ ‡§Ü‡§è‡§ó‡§æ ‡§î‡§∞ status ‡§ï‡•à‡§∏‡•á ‡§¶‡•á‡§ñ‡•á‡§Ç?')"
                        style="background:#e8f5e8; border:1px solid #4a7c59; color:#2d5016; padding:6px 14px; border-radius:20px; font-size:0.85rem; cursor:pointer; transition:all 0.2s;"
                        onmouseover="this.style.background='#4a7c59';this.style.color='white'"
                        onmouseout="this.style.background='#e8f5e8';this.style.color='#2d5016'">
                        üí∞ PM-Kisan status?
                    </button>
                    <button onclick="askSuggested('‡§ß‡§æ‡§® ‡§ï‡•Ä ‡§´‡§∏‡§≤ ‡§Æ‡•á‡§Ç ‡§ï‡•Ä‡§ü ‡§≤‡§ó ‡§∞‡§π‡§æ ‡§π‡•à, ‡§ï‡•ç‡§Ø‡§æ ‡§ï‡§∞‡•á‡§Ç?')"
                        style="background:#e8f5e8; border:1px solid #4a7c59; color:#2d5016; padding:6px 14px; border-radius:20px; font-size:0.85rem; cursor:pointer; transition:all 0.2s;"
                        onmouseover="this.style.background='#4a7c59';this.style.color='white'"
                        onmouseout="this.style.background='#e8f5e8';this.style.color='#2d5016'">
                        üêõ ‡§ß‡§æ‡§® ‡§Æ‡•á‡§Ç ‡§ï‡•Ä‡§ü?
                    </button>
                    <button onclick="askSuggested('‡§∏‡§∞‡§∏‡•ã‡§Ç ‡§ï‡§æ MSP ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à ‡§î‡§∞ ‡§ï‡§π‡§æ‡§Å ‡§¨‡•á‡§ö‡•á‡§Ç?')"
                        style="background:#e8f5e8; border:1px solid #4a7c59; color:#2d5016; padding:6px 14px; border-radius:20px; font-size:0.85rem; cursor:pointer; transition:all 0.2s;"
                        onmouseover="this.style.background='#4a7c59';this.style.color='white'"
                        onmouseout="this.style.background='#e8f5e8';this.style.color='#2d5016'">
                        üí∏ ‡§∏‡§∞‡§∏‡•ã‡§Ç ‡§ï‡§æ ‡§≠‡§æ‡§µ?
                    </button>
                    <button onclick="askSuggested('‡§ï‡§ø‡§∏‡§æ‡§® ‡§ï‡•ç‡§∞‡•á‡§°‡§ø‡§ü ‡§ï‡§æ‡§∞‡•ç‡§° KCC ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ü‡§µ‡•á‡§¶‡§® ‡§ï‡•à‡§∏‡•á ‡§ï‡§∞‡•á‡§Ç?')"
                        style="background:#e8f5e8; border:1px solid #4a7c59; color:#2d5016; padding:6px 14px; border-radius:20px; font-size:0.85rem; cursor:pointer; transition:all 0.2s;"
                        onmouseover="this.style.background='#4a7c59';this.style.color='white'"
                        onmouseout="this.style.background='#e8f5e8';this.style.color='#2d5016'">
                        üí≥ KCC ‡§ï‡•à‡§∏‡•á ‡§≤‡•á‡§Ç?
                    </button>
                    <button onclick="askSuggested('‡§ü‡§Æ‡§æ‡§ü‡§∞ ‡§Æ‡•á‡§Ç ‡§™‡•Ä‡§≤‡•Ä ‡§™‡§§‡•ç‡§§‡•Ä ‡§î‡§∞ ‡§∏‡§´‡•á‡§¶ ‡§Æ‡§ï‡•ç‡§ñ‡•Ä ‡§ï‡§æ ‡§â‡§™‡§ö‡§æ‡§∞ ‡§¨‡§§‡§æ‡§è‡§Ç')"
                        style="background:#e8f5e8; border:1px solid #4a7c59; color:#2d5016; padding:6px 14px; border-radius:20px; font-size:0.85rem; cursor:pointer; transition:all 0.2s;"
                        onmouseover="this.style.background='#4a7c59';this.style.color='white'"
                        onmouseout="this.style.background='#e8f5e8';this.style.color='#2d5016'">
                        üçÖ ‡§ü‡§Æ‡§æ‡§ü‡§∞ ‡§∞‡•ã‡§ó?
                    </button>
                    <button onclick="askSuggested('‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä ‡§ú‡§æ‡§Ç‡§ö (Soil Health Card) ‡§ï‡•à‡§∏‡•á ‡§ï‡§∞‡§µ‡§æ‡§è‡§Ç ‡§î‡§∞ ‡§ï‡§π‡§æ‡§Å ‡§ú‡§æ‡§è‡§Ç?')"
                        style="background:#e8f5e8; border:1px solid #4a7c59; color:#2d5016; padding:6px 14px; border-radius:20px; font-size:0.85rem; cursor:pointer; transition:all 0.2s;"
                        onmouseover="this.style.background='#4a7c59';this.style.color='white'"
                        onmouseout="this.style.background='#e8f5e8';this.style.color='#2d5016'">
                        üß™ ‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä ‡§ú‡§æ‡§Ç‡§ö?
                    </button>
                    <button onclick="askSuggested('‡§∏‡•ã‡§≤‡§∞ ‡§™‡§Ç‡§™ PM-KUSUM ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡§π‡§æ‡§Å ‡§Ü‡§µ‡•á‡§¶‡§® ‡§ï‡§∞‡•á‡§Ç?')"
                        style="background:#e8f5e8; border:1px solid #4a7c59; color:#2d5016; padding:6px 14px; border-radius:20px; font-size:0.85rem; cursor:pointer; transition:all 0.2s;"
                        onmouseover="this.style.background='#4a7c59';this.style.color='white'"
                        onmouseout="this.style.background='#e8f5e8';this.style.color='#2d5016'">
                        ‚òÄÔ∏è ‡§∏‡•ã‡§≤‡§∞ ‡§™‡§Ç‡§™?
                    </button>
                </div>
            </div>

            <!-- Chat Window -->
            <div class="chat-container" id="chatMessages"
                style="max-height: 450px; background: #f8fffe; border: 1px solid #d4edda; border-radius: 15px;">
                <div class="message bot-message"
                    style="background: linear-gradient(135deg, #e8f5e8, #f0fff0); border-left: 4px solid #4a7c59; border-radius: 10px; padding: 15px;">
                    <strong style="color: #2d5016;">üåæ KrishiMitra AI:</strong>
                    <div style="margin-top: 8px; color: #333; line-height: 1.6;">
                        ‡§®‡§Æ‡§∏‡•ç‡§§‡•á! ‡§Æ‡•à‡§Ç <strong>KrishiMitra AI</strong> ‡§π‡•Ç‡§Å ‚Äî ‡§Ü‡§™‡§ï‡§æ ‡§ï‡•É‡§∑‡§ø ‡§µ‡§ø‡§∂‡•á‡§∑‡§ú‡•ç‡§û‡•§<br><br>
                        ‡§Æ‡•à‡§Ç ‡§á‡§® ‡§µ‡§ø‡§∑‡§Ø‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§Æ‡§¶‡§¶ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡§æ ‡§π‡•Ç‡§Å:<br>
                        üåæ <strong>‡§´‡§∏‡§≤ ‡§ñ‡•á‡§§‡•Ä</strong> ‚Äî ‡§¨‡•Å‡§µ‡§æ‡§à, ‡§∏‡§ø‡§Ç‡§ö‡§æ‡§à, ‡§â‡§∞‡•ç‡§µ‡§∞‡§ï<br>
                        üí∞ <strong>‡§Æ‡§Ç‡§°‡•Ä ‡§≠‡§æ‡§µ</strong> ‚Äî MSP, Agmarknet, eNAM<br>
                        üèõÔ∏è <strong>‡§∏‡§∞‡§ï‡§æ‡§∞‡•Ä ‡§Ø‡•ã‡§ú‡§®‡§æ‡§è‡§Ç</strong> ‚Äî PM-Kisan, PMFBY, KCC<br>
                        üêõ <strong>‡§ï‡•Ä‡§ü-‡§∞‡•ã‡§ó</strong> ‚Äî ‡§™‡§π‡§ö‡§æ‡§® ‡§î‡§∞ ‡§â‡§™‡§ö‡§æ‡§∞<br>
                        üå§Ô∏è <strong>‡§Æ‡•å‡§∏‡§Æ ‡§∏‡§≤‡§æ‡§π</strong> ‚Äî ‡§ï‡§¨ ‡§ï‡•ç‡§Ø‡§æ ‡§ï‡§∞‡•á‡§Ç<br><br>
                        ‡§ä‡§™‡§∞ ‡§¶‡§ø‡§è ‡§∏‡§µ‡§æ‡§≤ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç ‡§Ø‡§æ ‡§ñ‡•Å‡§¶ ‡§™‡•Ç‡§õ‡•á‡§Ç! üëÜ
                    </div>
                </div>
            </div>

            <!-- Input Area -->
            <div style="margin-top: 15px; display: flex; gap: 10px; align-items: flex-end;">
                <div style="flex: 1; position: relative;">
                    <input type="text" class="form-control" id="messageInput"
                        placeholder="‡§ú‡•à‡§∏‡•á: '‡§ó‡•á‡§π‡•Ç‡§Å ‡§Æ‡•á‡§Ç ‡§ï‡§ø‡§§‡§®‡§æ Urea ‡§°‡§æ‡§≤‡•á‡§Ç?' ‡§Ø‡§æ 'PM-Kisan list ‡§Æ‡•á‡§Ç naam ‡§ï‡•à‡§∏‡•á add ‡§ï‡§∞‡•á‡§Ç?'"
                        style="padding: 14px 16px; border-radius: 12px; border: 2px solid #d4edda; font-size: 0.95rem; line-height: 1.4;"
                        onkeypress="if(event.key==='Enter')handleChatUserMessage()">
                </div>
                <button id="chatSendBtn" class="btn btn-success" onclick="handleChatUserMessage()"
                    style="padding: 14px 24px; border-radius: 12px; font-weight: 600; white-space: nowrap;">
                    <i class="fas fa-paper-plane"></i> ‡§≠‡•á‡§ú‡•á‡§Ç
                </button>
                <button onclick="clearChat()" class="btn btn-outline-secondary"
                    style="padding: 14px 16px; border-radius: 12px;" title="‡§ö‡•à‡§ü ‡§∏‡§æ‡§´ ‡§ï‡§∞‡•á‡§Ç">
                    <i class="fas fa-trash-alt"></i>
                </button>
            </div>

            <div id="loading" style="display: none; text-align: center; margin-top: 10px; color: #4a7c59;">
                <i class="fas fa-spinner fa-spin"></i> KrishiMitra AI ‡§∏‡•ã‡§ö ‡§∞‡§π‡§æ ‡§π‡•à...
            </div>

            <!-- Quick Info Bar -->
            <div
                style="margin-top: 20px; background: #fff3cd; border-radius: 10px; padding: 12px 15px; display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
                <span style="font-size: 1rem;">üí°</span>
                <span style="font-size: 0.88rem; color: #856404;">
                    <strong>Kisan Call Center:</strong> 1800-180-1551 (‡§®‡§ø‡§É‡§∂‡•Å‡§≤‡•ç‡§ï, 24√ó7) |
                    <strong>PM-Kisan:</strong> pmkisan.gov.in |
                    <strong>eNAM:</strong> enam.gov.in |
                    <strong>IMD:</strong> mausam.imd.gov.in
                </span>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification"></div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Global variables
        let currentLocation = 'Delhi';
        let currentLatitude = 28.7041;
        let currentLongitude = 77.1025;
        let sessionId = 'session_' + Date.now();
        let locationSearchTimeout;

        // Function to decode HTML entities
        function decodeHtmlEntities(text) {
            if (!text) return text;
            const textarea = document.createElement('textarea');
            textarea.innerHTML = text;
            return textarea.value;
        }

    </script>

    <!-- Enhanced Services Script -->

    <!-- Complete Inline Service Loading Script - ALL FEATURES -->
    <script>
        (function () {
            console.log('üåæ Complete Service Loader Starting...');

            // Global variables
            let currentLocation = 'Delhi';
            let currentLatitude = 28.7041;
            let currentLongitude = 77.1025;
            let currentMandi = 'All Mandis';
            let locationSearchTimeout;

            // ========================================
            // LOCATION FUNCTIONS
            // ========================================

            function updateLocation(locationName, latitude, longitude) {
                currentLocation = locationName;
                currentLatitude = latitude;
                currentLongitude = longitude;

                console.log(`üìç Location updated to: ${locationName} (${latitude}, ${longitude})`);

                const locationDisplay = document.getElementById('currentLocationDisplay');
                if (locationDisplay) {
                    locationDisplay.textContent = locationName;
                }

                console.log('üîÑ Reloading all services for new location...');
                loadMarketPrices();
                loadWeatherData();
                loadGovernmentSchemes();
                loadCropRecommendations();
            }

            function searchLocations(event) {
                clearTimeout(locationSearchTimeout);

                const input = event.target;
                const query = input.value.trim();

                if (query.length < 2) {
                    hideLocationSuggestions();
                    return;
                }

                locationSearchTimeout = setTimeout(() => {
                    const indianCities = [
                        { name: 'Delhi', lat: 28.7041, lon: 77.1025 },
                        { name: 'Mumbai', lat: 19.0760, lon: 72.8777 },
                        { name: 'Bangalore', lat: 12.9716, lon: 77.5946 },
                        { name: 'Hyderabad', lat: 17.3850, lon: 78.4867 },
                        { name: 'Chennai', lat: 13.0827, lon: 80.2707 },
                        { name: 'Kolkata', lat: 22.5726, lon: 88.3639 },
                        { name: 'Pune', lat: 18.5204, lon: 73.8567 },
                        { name: 'Ahmedabad', lat: 23.0225, lon: 72.5714 },
                        { name: 'Jaipur', lat: 26.9124, lon: 75.7873 },
                        { name: 'Lucknow', lat: 26.8467, lon: 80.9462 },
                        { name: 'Chandigarh', lat: 30.7333, lon: 76.7794 },
                        { name: 'Indore', lat: 22.7196, lon: 75.8577 },
                        { name: 'Bhopal', lat: 23.2599, lon: 77.4126 },
                        { name: 'Patna', lat: 25.5941, lon: 85.1376 },
                        { name: 'Nagpur', lat: 21.1458, lon: 79.0882 }
                    ];

                    const filtered = indianCities.filter(city =>
                        city.name.toLowerCase().includes(query.toLowerCase())
                    );

                    showLocationSuggestions(filtered);
                }, 300);
            }

            function showLocationSuggestions(suggestions) {
                const container = document.getElementById('locationSuggestions');
                if (!container || !suggestions) return;

                if (suggestions.length === 0) {
                    container.style.display = 'none';
                    return;
                }

                let html = '';
                suggestions.forEach(location => {
                    html += `
            <div class="location-suggestion" onclick="selectLocation('${location.name}', ${location.lat}, ${location.lon})" >
                        üìç ${location.name}
                    </div>
            `;
                });

                container.innerHTML = html;
                container.style.display = 'block';
            }

            function hideLocationSuggestions() {
                const container = document.getElementById('locationSuggestions');
                if (container) {
                    container.style.display = 'none';
                }
            }

            function selectLocation(locationName, latitude, longitude) {
                const input = document.getElementById('locationSearchInput');
                if (input) {
                    input.value = locationName;
                }

                hideLocationSuggestions();
                updateLocation(locationName, latitude, longitude);
            }

            function searchCurrentLocation() {
                const input = document.getElementById('locationSearchInput');
                if (input && input.value.trim()) {
                    const event = new Event('keyup');
                    input.dispatchEvent(event);
                }
            }

            function detectLocation() {
                if (!navigator.geolocation) {
                    alert('Geolocation is not supported by your browser');
                    return;
                }

                console.log('üåç Detecting location...');

                navigator.geolocation.getCurrentPosition(
                    position => {
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;

                        console.log(`üìç Detected coordinates: ${lat}, ${lon} `);

                        // Fetch location name using Reverse Geocoding
                        fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`)
                            .then(response => response.json())
                            .then(data => {
                                console.log('üìç Reverse geocoding result:', data);
                                const address = data.address;
                                // Try to find the most relevant location name
                                const locationName = address.city || address.town || address.village || address.suburb || address.county || 'Detected Location';

                                console.log(`üìç Resolved location name: ${locationName}`);
                                updateLocation(locationName, lat, lon);
                            })
                            .catch(error => {
                                console.error('‚ùå Error fetching location name:', error);
                                updateLocation('Detected Location', lat, lon);
                            });
                    },
                    error => {
                        console.error('Geolocation error:', error);
                        alert('Unable to detect location. Please search manually.');
                    }
                );
            }

            // ========================================
            // SERVICE NAVIGATION
            // ========================================

            function showService(serviceName) {
                const sections = document.querySelectorAll('.content-section');
                sections.forEach(section => {
                    section.style.display = 'none';
                });

                const targetSection = document.getElementById(serviceName + '-content');
                if (targetSection) {
                    targetSection.style.display = 'block';
                    targetSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }

            function setupServiceCards() {
                const serviceCards = document.querySelectorAll('.service-card, [onclick*="showService"]');
                serviceCards.forEach((card, index) => {
                    const onclickAttr = card.getAttribute('onclick');
                    if (onclickAttr) {
                        const match = onclickAttr.match(/showService\('([^']+)'\)/);
                        if (match) {
                            const serviceName = match[1];
                            card.onclick = function (e) {
                                e.preventDefault();
                                showService(serviceName);
                            };
                        }
                    }
                });
                console.log('‚úÖ Service cards setup complete');
            }

            // ========================================
            // DATA LOADING FUNCTIONS
            // ========================================

            // Known mandis per region (for dropdown population)
            const NEARBY_MANDIS = {
                default: ['Azadpur Mandi', 'Okhla Mandi', 'Ghazipur Mandi', 'Lawrence Road Mandi', 'Narela Mandi'],
                Delhi: ['Azadpur Mandi', 'Okhla Mandi', 'Ghazipur Mandi', 'Lawrence Road Mandi', 'Narela Mandi'],
                Noida: ['Ghaziabad Mandi', 'Noida Mandi', 'Greater Noida Mandi', 'Hapur Mandi', 'Dadri Mandi'],
                Mumbai: ['Vashi APMC', 'Crawford Market', 'Turbhe Market', 'Deonar Market', 'Thane Market'],
                Pune: ['Pune Market Yard', 'Hadapsar Market', 'Pimpri Market', 'Jejuri Market', 'Shirur Market'],
                Bengaluru: ['KR Market', 'Yeshwanthpur APMC', 'Yelahanka Market', 'Hopcoms', 'Attibele Market'],
                Hyderabad: ['Bowenpally Market', 'Gaddiannaram Market', 'Kothapet Market', 'LB Nagar Market', 'Shamshabad Market'],
                Chennai: ['Koyambedu Market', 'Pallavaram Market', 'Thiruvottiyur Market', 'Ambattur Market', 'Adyar Market'],
                Kolkata: ['Koley Market', 'Lake Market', 'Howrah Market', 'Maniktala Market', 'Ballygunge Market'],
                Jaipur: ['Murlipura Mandi', 'Chomu Mandi', 'Sanganer Mandi', 'Bassi Mandi', 'Phagi Mandi'],
            };

            function populateMandiDropdown(location) {
                const sel = document.getElementById('mandiSelector');
                if (!sel) return;
                const key = Object.keys(NEARBY_MANDIS).find(k => location && location.toLowerCase().includes(k.toLowerCase())) || 'default';
                const mandis = NEARBY_MANDIS[key] || NEARBY_MANDIS['default'];
                // Keep first "All Mandis" option, rebuild rest
                sel.innerHTML = '<option value="">-- ‡§∏‡§≠‡•Ä ‡§Æ‡§Ç‡§°‡§ø‡§Ø‡§æ‡§Ç (All Mandis) --</option>';
                mandis.forEach(m => {
                    const opt = document.createElement('option');
                    opt.value = m;
                    opt.textContent = m;
                    if (m === currentMandi) opt.selected = true;
                    sel.appendChild(opt);
                });
            }

            function onMandiSelected(mandiName) {
                currentMandi = mandiName || 'All Mandis';
                const badge = document.getElementById('mandiStatusBadge');
                if (badge) badge.textContent = mandiName ? `üìç ${mandiName} ‡§ï‡§æ ‡§≠‡§æ‡§µ ‡§¶‡§ø‡§ñ‡§æ‡§Ø‡§æ ‡§ú‡§æ ‡§∞‡§π‡§æ ‡§π‡•à` : '';
                loadMarketPrices();
            }

            async function loadMarketPrices() {
                const container = document.getElementById('pricesData');
                if (!container) return;

                try {
                    container.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i> ‡§¨‡§æ‡§ú‡§æ‡§∞ ‡§≠‡§æ‡§µ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡•á ‡§π‡•à‡§Ç...</div>';

                    // Populate mandi dropdown for current location
                    populateMandiDropdown(currentLocation);

                    // Build URL ‚Äî include mandi filter if one is selected
                    let url = `/api/market-prices/?location=${encodeURIComponent(currentLocation)}&latitude=${currentLatitude}&longitude=${currentLongitude}&v=v2.0`;
                    if (currentMandi && currentMandi !== 'All Mandis') {
                        url += `&mandi=${encodeURIComponent(currentMandi)}`;
                    }

                    const response = await fetch(url);
                    if (!response.ok) throw new Error(`HTTP ${response.status}`);
                    const data = await response.json();

                    console.log('Market data:', data);

                    const crops = data.top_crops || data.crops || [];
                    const selectedMandi = currentMandi !== 'All Mandis' ? currentMandi : (data.location || currentLocation);

                    if (crops && crops.length > 0) {
                        const sourceLabel = data.status === 'fallback'
                            ? 'üìä MSP ‡§Ü‡§ß‡§æ‡§∞‡§ø‡§§ ‡§Ö‡§®‡•Å‡§Æ‡§æ‡§® (Agmarknet ‡§∏‡•á ‡§∞‡§ø‡§Ø‡§≤-‡§ü‡§æ‡§á‡§Æ ‡§°‡•á‡§ü‡§æ ‡§ï‡•á ‡§≤‡§ø‡§è mandi ‡§ö‡•Å‡§®‡•á‡§Ç)'
                            : `üìä ${data.data_source || 'Agmarknet + eNAM'}`;

                        let html = `
                        <div style="margin-bottom:16px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:8px;">
                            <div>
                                <div style="font-size:0.88rem;color:#888;">${sourceLabel}</div>
                                <div style="font-size:0.82rem;color:#aaa;">üïí ${data.timestamp ? new Date(data.timestamp).toLocaleString('hi-IN') : ''}</div>
                            </div>
                            <div style="font-size:0.88rem;color:#4a7c59;font-weight:600;">üìç ${selectedMandi}</div>
                        </div>
                        <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:16px;">`;

                        crops.forEach(crop => {
                            const price = crop.modal_price || crop.current_price || crop.min_price || 0;
                            const msp = crop.msp || 0;
                            const profit = crop.profit_vs_msp !== undefined ? crop.profit_vs_msp : (crop.profit || 0);
                            const profitLabel = `+${profit}% vs MSP`;
                            const profitColor = profit >= 0 ? '#28a745' : '#dc3545';
                            const indicator = crop.profit_indicator || (profit >= 0 ? 'üìà' : 'üìâ');
                            const minP = crop.min_price || 0;
                            const maxP = crop.max_price || 0;

                            html += `
                            <div style="background:white;border-radius:14px;padding:18px;box-shadow:0 3px 12px rgba(0,0,0,0.08);border-top:3px solid #4a7c59;">
                                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
                                    <span style="font-weight:700;color:#2d5016;font-size:1rem;">${crop.crop_name_hindi || crop.crop_name}</span>
                                    <span style="font-size:1.2rem;">${indicator}</span>
                                </div>
                                <div style="text-align:center;margin-bottom:12px;background:#f0f8f0;border-radius:10px;padding:10px;">
                                    <div style="font-size:1.7rem;font-weight:700;color:#4a7c59;">‚Çπ${price.toLocaleString('hi-IN')}</div>
                                    <div style="color:#888;font-size:0.78rem;">‡§Æ‡•â‡§°‡§≤ ‡§≠‡§æ‡§µ / ‡§ï‡•ç‡§µ‡§ø‡§Ç‡§ü‡§≤</div>
                                    ${minP && maxP ? `<div style="color:#999;font-size:0.78rem;">‚Çπ${minP.toLocaleString()} ‚Äì ‚Çπ${maxP.toLocaleString()}</div>` : ''}
                                </div>
                                <div style="font-size:0.85rem;line-height:2;">
                                    <div style="display:flex;justify-content:space-between;border-bottom:1px solid #f0f0f0;">
                                        <span style="color:#666;">MSP 2024-25</span>
                                        <span style="font-weight:600;">‚Çπ${msp.toLocaleString('hi-IN')}</span>
                                    </div>
                                    <div style="display:flex;justify-content:space-between;">
                                        <span style="color:#666;">MSP ‡§∏‡•á ‡§≤‡§æ‡§≠</span>
                                        <span style="font-weight:700;color:${profitColor};">${profitLabel}</span>
                                    </div>
                                </div>
                            </div>`;
                        });

                        html += '</div>';
                        container.innerHTML = html;
                        console.log('‚úÖ Market prices loaded:', crops.length, 'crops for', selectedMandi);
                    } else {
                        container.innerHTML = '<div style="padding:20px;text-align:center;color:#856404;">‡§¨‡§æ‡§ú‡§æ‡§∞ ‡§≠‡§æ‡§µ ‡§Ö‡§≠‡•Ä ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡§Ç‡•§ ‡§•‡•ã‡§°‡§º‡•Ä ‡§¶‡•á‡§∞ ‡§Æ‡•á‡§Ç ‡§™‡•Å‡§®‡§É ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç‡•§</div>';
                    }
                } catch (error) {
                    console.error('Market prices error:', error);
                    container.innerHTML = `<div style="padding:20px;text-align:center;color:#dc3545;">‡§¨‡§æ‡§ú‡§æ‡§∞ ‡§≠‡§æ‡§µ ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø: ${error.message}</div>`;
                }
            }

            function selectMandi(mandiName) {
                currentMandi = mandiName || 'All Mandis';
                const sel = document.getElementById('mandiSelector');
                if (sel) sel.value = mandiName || '';
                loadMarketPrices();
            }

                    async function loadWeatherData() {
                        try {
                            const container = document.getElementById('weatherData');
                            if (!container) return;

                            container.innerHTML = '<div class="loading">‡§Æ‡•å‡§∏‡§Æ ‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</div>';

                            const response = await fetch(`/api/weather/?location=${currentLocation}&latitude=${currentLatitude}&longitude=${currentLongitude}`);
                            const data = await response.json();
                            // Store weather data globally for chatbot context
                            window.lastWeatherData = data;

                            console.log('Weather data:', data);

                            // Support both API response formats (current vs current_weather)
                            const weather = data.current_weather || data.current || {};
                            const forecast = data.forecast_7_days || data.forecast_7day || [];

                            if (weather && data.location) {
                                let html = `
                        <div style="background: white; border-radius: 15px; padding: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 20px;">
                            <h4 style="color: #2d5016; margin-bottom: 20px;">üå§Ô∏è ‡§Æ‡•å‡§∏‡§Æ ‡§ï‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä - ${data.location}</h4>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                                <div style="text-align: center;">
                                    <div style="font-size: 3rem; font-weight: 700; color: #4a7c59;">${weather.temperature || '28¬∞C'}</div>
                                    <div style="color: #666; margin-top: 10px;">${weather.condition || weather.description || '‡§∏‡§æ‡§´ ‡§Ü‡§∏‡§Æ‡§æ‡§®'}</div>
                                </div>
                                <div>
                                    <div style="margin-bottom: 10px;">üíß ‡§®‡§Æ‡•Ä: ${weather.humidity || '65%'}</div>
                                    <div style="margin-bottom: 10px;">üí® ‡§π‡§µ‡§æ: ${weather.wind_speed || '12 km/h'}</div>
                                    <div style="margin-bottom: 10px;">üå°Ô∏è ‡§Ö‡§®‡•Å‡§≠‡§µ: ${weather.feels_like || '30¬∞C'}</div>
                                    <div style="margin-bottom: 10px;">üìä ‡§¶‡§¨‡§æ‡§µ: ${weather.pressure || '1013'} ${weather.pressure_unit || 'hPa'}</div>
                                </div>
                            </div>
                        </div>
                    `;

                                if (forecast && forecast.length > 0) {
                                    html += `
                            <div style="background: white; border-radius: 15px; padding: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                                <h5 style="color: #2d5016; margin-bottom: 15px;">üìÖ 7 ‡§¶‡§ø‡§® ‡§ï‡§æ ‡§™‡•Ç‡§∞‡•ç‡§µ‡§æ‡§®‡•Å‡§Æ‡§æ‡§®</h5>
                                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px;">
                        `;

                                    forecast.slice(0, 7).forEach(day => {
                                        html += `
                                <div style="background: #f8f9fa; border-radius: 10px; padding: 15px; text-align: center;">
                                    <div style="font-weight: 700; color: #2d5016; margin-bottom: 5px;">${day.day || day.date}</div>
                                    <div style="font-size: 1.5rem; color: #4a7c59; margin: 10px 0;">${day.temperature || (day.max_temp ? day.max_temp + '¬∞C' : '28¬∞C')}</div>
                                    <div style="font-size: 0.85rem; color: #555;">${day.condition || '‡§∏‡§æ‡§´'}</div>
                                    ${day.rainfall_mm !== undefined ? `<div style="font-size: 0.8rem; color: #007bff; margin-top: 4px;">üåß ${day.rainfall_mm}mm</div>` : ''}
                                </div>
                            `;
                                    });

                                    html += '</div></div>';
                                }

                                container.innerHTML = html;
                                console.log('‚úÖ Weather loaded with', forecast.length, 'day forecast');
                            } else {
                                container.innerHTML = '<div style="padding: 20px; text-align: center;">‡§Æ‡•å‡§∏‡§Æ ‡§°‡•á‡§ü‡§æ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à</div>';
                            }
                        } catch (error) {
                            console.error('Weather error:', error);
                            const container = document.getElementById('weatherData');
                            if (container) container.innerHTML = '<div style="padding: 20px; text-align: center; color: #dc3545;">‡§Æ‡•å‡§∏‡§Æ ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø</div>';
                        }
                    }

                    async function loadGovernmentSchemes() {
                        const container = document.getElementById('schemesData');
                        if (!container) return;

                        try {
                            container.innerHTML = '<div class="loading">‡§Ø‡•ã‡§ú‡§®‡§æ‡§è‡§Ç ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡•Ä ‡§π‡•à‡§Ç... (Fetching)</div>';

                            const response = await fetch(`/api/government-schemes/?location=${currentLocation}`);

                            if (!response.ok) {
                                throw new Error(`HTTP error! status: ${response.status}`);
                            }

                            container.innerHTML = '<div class="loading">‡§Ø‡•ã‡§ú‡§®‡§æ‡§è‡§Ç ‡§™‡§æ‡§∞‡•ç‡§∏ ‡§π‡•ã ‡§∞‡§π‡•Ä ‡§π‡•à‡§Ç... (Parsing)</div>';
                            const data = await response.json();
                            console.log('Schemes data:', data);

                            const schemes = data.schemes || [];

                            if (schemes && schemes.length > 0) {
                                let html = '<div style="display: grid; gap: 20px;">';

                                schemes.forEach(scheme => {
                                    const officialUrl = scheme.official_website || scheme.website || scheme.apply_url || '#';
                                    const benefitText = scheme.benefits_hindi || scheme.benefit_hindi || scheme.benefit || '‡§µ‡§ø‡§µ‡§∞‡§£ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç';
                                    const eligibilityText = scheme.eligibility_hindi || scheme.eligibility || '‡§∏‡§≠‡•Ä ‡§ï‡§ø‡§∏‡§æ‡§®';
                                    const descText = scheme.description_hindi || scheme.description || '';

                                    html += `
                            <div style="background: white; border-radius: 15px; padding: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border-left: 5px solid #4a7c59; cursor: pointer; transition: transform 0.3s;"
                                 onclick="window.open('${officialUrl}', '_blank')"
                                 onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 8px 25px rgba(0,0,0,0.15)'"
                                 onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(0,0,0,0.1)'">
                                <div style="display: flex; justify-content: space-between; align-items: start;">
                                    <h5 style="color: #2d5016; margin-bottom: 15px;">üìã ${scheme.name_hindi || scheme.name}</h5>
                                    <span style="color: #4a7c59; font-size: 1.5rem;">üîó</span>
                                </div>
                                <p style="color: #666; margin-bottom: 15px; line-height: 1.6;">${descText}</p>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">
                                    <div>
                                        <strong style="color: #2d5016;">üí∞ ‡§≤‡§æ‡§≠:</strong>
                                        <div style="color: #666; font-size: 0.9rem; margin-top: 5px;">${benefitText}</div>
                                    </div>
                                    <div>
                                        <strong style="color: #2d5016;">‚úÖ ‡§™‡§æ‡§§‡•ç‡§∞‡§§‡§æ:</strong>
                                        <div style="color: #666; font-size: 0.9rem; margin-top: 5px;">${eligibilityText}</div>
                                    </div>
                                </div>
                                <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee; color: #4a7c59; font-size: 0.9rem; font-weight: 600;">
                                    üëÜ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç ‡§Ü‡§ß‡§ø‡§ï‡§æ‡§∞‡§ø‡§ï ‡§µ‡•á‡§¨‡§∏‡§æ‡§á‡§ü ‡§™‡§∞ ‡§ú‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è
                                </div>
                            </div>
                        `;
                                });

                                html += '</div>';
                                container.innerHTML = html;
                                console.log('‚úÖ Schemes loaded:', schemes.length, 'schemes');
                            } else {
                                container.innerHTML = '<div style="padding: 20px; text-align: center;">‡§Ø‡•ã‡§ú‡§®‡§æ‡§è‡§Ç ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡§Ç (No schemes data)</div>';
                            }
                        } catch (error) {
                            console.error('Schemes error:', error);
                            container.innerHTML = `<div style="padding: 20px; text-align: center; color: #dc3545;">
                        <strong>‡§Ø‡•ã‡§ú‡§®‡§æ‡§è‡§Ç ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø</strong><br>
                        <small>${error.message}</small>
                    </div>`;
                        }
                    }

                    async function loadCropRecommendations() {
                        try {
                            const container = document.getElementById('cropsData');
                            if (!container) return;

                            container.innerHTML = '<div class="loading">‡§´‡§∏‡§≤ ‡§∏‡•Å‡§ù‡§æ‡§µ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡•á ‡§π‡•à‡§Ç...</div>';

                            const response = await fetch(`/api/advisories/?location=${currentLocation}`);
                            const data = await response.json();

                            console.log('Crops data:', data);

                            const recommendations = data.recommendations || [];

                            // Helper for category icons
                            const getCategoryIcon = (category) => {
                                const icons = {
                                    'Cereal': 'üåæ', 'Pulse': 'ü´ò', 'Oilseed': 'üåª', 'Vegetable': 'ü•¶',
                                    'Fruit': 'üçé', 'Spice': 'üå∂Ô∏è', 'Commercial': 'üí∞', 'Medicinal': 'üåø',
                                    'Fiber': 'cotton', 'Beverage': '‚òï', 'Nut': 'ü•ú', 'Sugar': 'üç¨',
                                    'Fungi': 'üçÑ', 'Algae': 'ü¶†', 'Exotic': '‚ú®', 'Flower': 'üå∏'
                                };
                                return icons[category] || 'üå±';
                            };

                            // Helper for water requirement color
                            const getWaterColor = (req) => {
                                if (req === 'high' || req === 'High') return '#007bff'; // Blue
                                if (req === 'moderate' || req === 'Moderate') return '#28a745'; // Green
                                return '#fd7e14'; // Orange for low
                            };

                            if (recommendations && recommendations.length > 0) {
                                let html = `
                        <div class="real-time-header" style="background: linear-gradient(135deg, #2d5016 0%, #4a7c59 100%); margin-bottom: 25px;">
                            <h4 style="color: white; margin-bottom: 10px;">${data.season} ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡§∞‡•ç‡§µ‡•ã‡§§‡•ç‡§§‡§Æ ‡§´‡§∏‡§≤ ‡§∏‡•Å‡§ù‡§æ‡§µ - ${data.region}</h4>
                            <p style="color: rgba(255,255,255,0.9); margin: 5px 0;">üìä ‡§∏‡•ç‡§∞‡•ã‡§§: ${data.data_source}</p>
                            <p style="color: rgba(255,255,255,0.8); font-size: 0.9rem;">${data.message}</p>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px;">
                    `;

                                recommendations.forEach(crop => {
                                    const suitabilityColor = crop.suitability_score >= 85 ? '#28a745' : crop.suitability_score >= 70 ? '#ffc107' : '#dc3545';
                                    const categoryIcon = getCategoryIcon(crop.category);
                                    const waterColor = getWaterColor(crop.water_requirement);

                                    // Check for ML predictions
                                    let mlBadge = '';
                                    if (crop.ml_confidence || (crop.prediction_data && crop.prediction_data.confidence)) {
                                        const confidence = crop.ml_confidence || crop.prediction_data.confidence;
                                        const confidencePercent = Math.round(confidence * 100);
                                        if (confidencePercent > 0) {
                                            mlBadge = `<div style="margin-top: 10px; background: #e8f0fe; padding: 8px; border-radius: 8px; font-size: 0.85rem; color: #1967d2; display: flex; align-items: center; gap: 5px; border: 1px solid #d2e3fc;">
                                        <span>ü§ñ AI Confidence: <strong>${confidencePercent}%</strong></span>
                                        ${crop.prediction_data && crop.prediction_data.predicted_yield ? `<span style="margin-left: auto; border-left: 1px solid #ccc; padding-left: 8px;">Est. Yield: <strong>${crop.prediction_data.predicted_yield.toFixed(1)} Q/ha</strong></span>` : ''}
                                    </div>`;
                                        }
                                    }

                                    html += `
                            <div style="background: white; border-radius: 15px; padding: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.08); transition: transform 0.3s; position: relative; overflow: hidden; border-top: 4px solid ${suitabilityColor};">
                                <div style="position: absolute; top: 10px; right: 10px; background: #f8f9fa; padding: 5px 10px; border-radius: 20px; font-size: 0.8rem; font-weight: 700; color: #333; border: 1px solid #ddd;">
                                    ${categoryIcon} ${crop.category}
                                </div>
                                
                                <h5 style="color: #2d5016; font-weight: 700; margin-bottom: 5px; font-size: 1.25rem;">${crop.crop_name_hindi}</h5>
                                <div style="color: #444; font-size: 0.9rem; margin-bottom: 15px; font-weight: 500;">${crop.crop_name}</div>
                                
                                <div style="display: flex; align-items: center; margin-bottom: 15px;">
                                    <div style="flex-grow: 1; height: 8px; background: #eee; border-radius: 4px; overflow: hidden;">
                                        <div style="width: ${crop.suitability_score}%; height: 100%; background: ${suitabilityColor}; border-radius: 4px;"></div>
                                    </div>
                                    <span style="margin-left: 10px; font-weight: 700; color: ${suitabilityColor};">${crop.suitability_score}%</span>
                                </div>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 0.9rem; background: #f8f9fa; padding: 10px; border-radius: 10px; mb-3; border: 1px solid #eee;">
                                    <div>
                                        <div style="color: #444; font-size: 0.85rem; font-weight: 600;">‡§Ö‡§®‡•Å‡§Æ‡§æ‡§®‡§ø‡§§ ‡§≤‡§æ‡§≠</div>
                                        <div style="font-weight: 700; color: #28a745; font-size: 1rem;">‚Çπ${crop.profit_per_hectare.toLocaleString('hi-IN')}</div>
                                    </div>
                                    <div>
                                        <div style="color: #444; font-size: 0.85rem; font-weight: 600;">‡§â‡§™‡§ú (‡§ï‡•ç‡§µ‡§ø‡§Ç‡§ü‡§≤/‡§π‡•á.)</div>
                                        <div style="font-weight: 700; color: #2d5016; font-size: 1rem;">${crop.yield_per_hectare} Q</div>
                                    </div>
                                    <div>
                                        <div style="color: #444; font-size: 0.85rem; font-weight: 600;">‡§Ö‡§µ‡§ß‡§ø</div>
                                        <div style="font-weight: 600; color: #333;">${crop.duration_days} ‡§¶‡§ø‡§®</div>
                                    </div>
                                     <div>
                                        <div style="color: #444; font-size: 0.85rem; font-weight: 600;">‡§™‡§æ‡§®‡•Ä ‡§ï‡•Ä ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ</div>
                                        <div style="font-weight: 600; color: ${waterColor}; text-transform: capitalize;">${crop.water_requirement}</div>
                                    </div>
                                </div>

                                ${mlBadge}
                                
                                <div style="margin-top: 15px; font-size: 0.9rem; color: #222; background: #fff3cd; padding: 10px; border-radius: 8px; border-left: 3px solid #ffc107;">
                                    üí° <strong>‡§∏‡•Å‡§ù‡§æ‡§µ:</strong> ${crop.reason_hindi}
                                </div>
                            </div>
                        `;
                                });

                                html += '</div>';
                                container.innerHTML = html;
                                console.log('‚úÖ Crops loaded:', recommendations.length, 'recommendations');
                            } else {
                                container.innerHTML = '<div style="padding: 20px; text-align: center;">‡§´‡§∏‡§≤ ‡§∏‡•Å‡§ù‡§æ‡§µ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡§Ç</div>';
                            }
                        } catch (error) {
                            console.error('Crops error:', error);
                            const container = document.getElementById('cropsData');
                            if (container) container.innerHTML = '<div style="padding: 20px; text-align: center; color: #dc3545;">‡§´‡§∏‡§≤ ‡§∏‡•Å‡§ù‡§æ‡§µ ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø</div>';
                        }
                    }

                    // ========================================
                    // KRISHI RAKSHA 2.0 DIAGNOSTICS
                    // ========================================
                    async function runKrishiRakshaDiagnosis() {
                        const cropSelect = document.getElementById('krCropSelect');
                        const resultsContainer = document.getElementById('krishiRakshaResults');

                        const crop = cropSelect.value;
                        if (!crop) {
                            alert('‡§ï‡•É‡§™‡§Ø‡§æ ‡§´‡§∏‡§≤ ‡§ö‡•Å‡§®‡•á‡§Ç / Please select a crop first');
                            return;
                        }

                        // Show loading state
                        resultsContainer.style.display = 'block';
                        resultsContainer.innerHTML = `
                    <div class="text-center p-5">
                        <i class="fas fa-spinner fa-spin fa-3x text-success"></i>
                        <h4 class="mt-3">Analyzing ${crop.charAt(0).toUpperCase() + crop.slice(1)}...</h4>
                        <p>Running Dual AI Pipeline ‚Ä¢ Verifying with Weather Data...</p>
                    </div>
                `;

                        try {
                            const response = await fetch('/api/diagnostics/detect/', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({
                                    crop: crop,
                                    location: currentLocation,
                                    images: {},
                                    session_id: 'kr_' + Date.now()
                                })
                            });

                            const data = await response.json();
                            console.log('KrishiRaksha Response:', data);

                            if (data.status === 'success') {
                                displayKrishiRakshaResults(data);
                            } else {
                                resultsContainer.innerHTML = `
                            <div class="alert alert-danger">
                                <i class="fas fa-exclamation-triangle"></i> ${data.message || 'Diagnosis failed'}
                            </div>
                        `;
                            }
                        } catch (error) {
                            console.error('KrishiRaksha Error:', error);
                            resultsContainer.innerHTML = `
                        <div class="alert alert-danger">
                            <i class="fas fa-exclamation-triangle"></i> Error connecting to diagnostic service
                        </div>
                    `;
                        }
                    }

                    function displayKrishiRakshaResults(data) {
                        const resultsContainer = document.getElementById('krishiRakshaResults');
                        const diagnoses = data.diagnosis || [];

                        let html = `
                    <div class="real-time-header">
                        <h4>ü©∫ Diagnostic Report: ${data.crop_detected.charAt(0).toUpperCase() + data.crop_detected.slice(1)}</h4>
                        <p class="data-source">üìç Location: ${data.location}</p>
                        <p class="timestamp">üïí ${new Date(data.timestamp).toLocaleString('hi-IN')}</p>
                    </div>

                    <div class="row g-4 mt-3">
                `;

                        diagnoses.forEach((d, idx) => {
                            const severityColor = d.severity_label === 'High' ? '#dc3545' : (d.severity_label === 'Medium' ? '#ffc107' : '#28a745');
                            const confidencePercent = Math.round(d.confidence * 100);

                            html += `
                        <div class="col-md-6">
                            <div class="card shadow-sm h-100" style="border-left: 4px solid ${severityColor};">
                                <div class="card-header bg-light">
                                    <h5 class="mb-0" style="color: #2d5016; font-weight: 700;">${d.name}</h5>
                                    <small style="color: #444; font-weight: 600;">Rank #${idx + 1}</small>
                                </div>
                                <div class="card-body">
                                    <!-- Confidence -->
                                    <div class="mb-3">
                                        <div class="d-flex justify-content-between mb-1">
                                            <span style="color: #333;"><strong>Confidence:</strong></span>
                                            <span class="badge bg-primary">${confidencePercent}%</span>
                                        </div>
                                        <div class="progress" style="height: 8px;">
                                            <div class="progress-bar bg-primary" style="width: ${confidencePercent}%"></div>
                                        </div>
                                    </div>

                                    <!-- Severity -->
                                    <div class="mb-3">
                                        <div class="d-flex justify-content-between mb-1">
                                            <span style="color: #333;"><strong>Severity:</strong></span>
                                            <span class="badge" style="background-color: ${severityColor}; color: white;">${d.severity_label} (${d.severity_score}%)</span>
                                        </div>
                                        <div class="progress" style="height: 8px;">
                                            <div class="progress-bar" style="width: ${d.severity_score}%; background-color: ${severityColor};"></div>
                                        </div>
                                    </div>

                                    <!-- Symptoms -->
                                    <div class="mb-3">
                                        <strong style="color: #2d5016;">Symptoms:</strong>
                                        <ul class="mb-0 mt-1" style="color: #333;">
                                            ${d.symptoms.map(s => `<li>${s}</li>`).join('')}
                                        </ul>
                                    </div>

                                    <!-- Treatment -->
                                    <div class="mb-2">
                                        <strong style="color: #2d5016;">Treatment:</strong>
                                        <ul class="mb-0 mt-1" style="color: #333;">
                                            ${d.treatment.map(t => `<li>${t}</li>`).join('')}
                                        </ul>
                                    </div>

                                    ${d.verification_note ? `
                                        <div class="alert alert-info py-2 px-3 mt-3 mb-0" style="background-color: #d1ecf1; border-color: #bee5eb; color: #0c5460;">
                                            <small><i class="fas fa-info-circle"></i> ${d.verification_note}</small>
                                        </div>
                                    ` : ''}

                                    ${d.explanation ? `
                                        <div class="alert alert-secondary py-2 px-3 mt-2 mb-0" style="background-color: #e2e3e5; border-color: #d6d8db; color: #383d41;">
                                            <small><strong>Explanation:</strong> ${d.explanation}</small>
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    `;
                        });

                        html += `
                    </div>

                    <!-- Feedback Section -->
                    <div class="card mt-4 shadow-sm">
                        <div class="card-header bg-warning text-dark">
                            <h5 class="mb-0"><i class="fas fa-comment-dots"></i> Was this diagnosis helpful?</h5>
                        </div>
                        <div class="card-body text-center">
                            <button class="btn btn-success me-2" onclick="submitKRFeedback(true)">
                                <i class="fas fa-thumbs-up"></i> Yes, Accurate
                            </button>
                            <button class="btn btn-danger" onclick="submitKRFeedback(false)">
                                <i class="fas fa-thumbs-down"></i> No, Incorrect
                            </button>
                        </div>
                    </div>
                `;

                        resultsContainer.innerHTML = html;
                    }

                    async function submitKRFeedback(isCorrect) {
                        try {
                            await fetch('/api/diagnostics/feedback/', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({
                                    session_id: 'kr_' + Date.now(),
                                    is_correct: isCorrect
                                })
                            });
                            alert(isCorrect ? '‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶! Feedback recorded.' : 'Thank you. We will improve our model.');
                        } catch (error) {
                            console.error('Feedback error:', error);
                        }
                    }

                    // ========================================
                    // AI CHAT FUNCTIONS
                    // ========================================
                    async function handleChatUserMessage() {
                        const input = document.getElementById('messageInput');
                        const chatMessages = document.getElementById('chatMessages');
                        if (!input || !chatMessages) return;

                        const message = input.value.trim();
                        if (!message) return;

                        // Add user message to chat
                        const userDiv = document.createElement('div');
                        userDiv.className = 'message user-message';
                        userDiv.style.cssText = 'background:#4a7c59;color:white;padding:12px 16px;border-radius:12px 12px 4px 12px;margin:8px 0 8px auto;max-width:80%;text-align:right;';
                        userDiv.textContent = message;
                        chatMessages.appendChild(userDiv);
                        input.value = '';
                        chatMessages.scrollTop = chatMessages.scrollHeight;

                        // Show loading indicator (inline, not the shared #loading div)
                        const loadingDiv = document.createElement('div');
                        loadingDiv.id = 'chatLoadingMsg';
                        loadingDiv.style.cssText = 'padding:12px;color:#4a7c59;font-size:0.9rem;';
                        loadingDiv.innerHTML = '<i class="fas fa-spinner fa-spin"></i> KrishiMitra AI ‡§∏‡•ã‡§ö ‡§∞‡§π‡§æ ‡§π‡•à...';
                        chatMessages.appendChild(loadingDiv);
                        chatMessages.scrollTop = chatMessages.scrollHeight;

                        try {
                            const response = await fetch('/api/chatbot/query/', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({
                                    query: message,
                                    location: currentLocation,
                                    session_id: sessionId
                                })
                            });
                            const data = await response.json();
                            const botReply = data.response || data.answer || data.message || '‡§Æ‡•Å‡§ù‡•á ‡§∏‡§Æ‡§ù ‡§®‡§π‡•Ä‡§Ç ‡§Ü‡§Ø‡§æ, ‡§ï‡•É‡§™‡§Ø‡§æ ‡§´‡§ø‡§∞ ‡§∏‡•á ‡§™‡•Ç‡§õ‡•á‡§Ç‡•§';

                            // Remove loading indicator
                            const ld = document.getElementById('chatLoadingMsg');
                            if (ld) ld.remove();

                            const botDiv = document.createElement('div');
                            botDiv.className = 'message bot-message';
                            botDiv.style.cssText = 'background:linear-gradient(135deg,#e8f5e8,#f0fff0);border-left:4px solid #4a7c59;border-radius:10px;padding:15px;margin:8px 0;';
                            botDiv.innerHTML = '<strong style="color:#2d5016;">üåæ KrishiMitra AI:</strong><div style="margin-top:8px;color:#333;line-height:1.6;white-space:pre-wrap;">' + botReply + '</div>';
                            chatMessages.appendChild(botDiv);
                        } catch (error) {
                            const ld = document.getElementById('chatLoadingMsg');
                            if (ld) ld.remove();

                            const errDiv = document.createElement('div');
                            errDiv.style.cssText = 'background:#fff3cd;border-left:4px solid #ffc107;border-radius:10px;padding:12px;margin:8px 0;color:#856404;';
                            errDiv.textContent = '‡§®‡•á‡§ü‡§µ‡§∞‡•ç‡§ï ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§¶‡•ã‡§¨‡§æ‡§∞‡§æ ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç‡•§';
                            chatMessages.appendChild(errDiv);
                        } finally {
                            chatMessages.scrollTop = chatMessages.scrollHeight;
                        }
                    }

                    function askSuggested(question) {
                        const input = document.getElementById('messageInput');
                        if (input) {
                            input.value = question;
                            handleChatUserMessage();
                        }
                    }

                    function clearChat() {
                        const chatMessages = document.getElementById('chatMessages');
                        if (chatMessages) {
                            chatMessages.innerHTML = '<div class="message bot-message" style="background:linear-gradient(135deg,#e8f5e8,#f0fff0);border-left:4px solid #4a7c59;border-radius:10px;padding:15px;"><strong style="color:#2d5016;">üåæ KrishiMitra AI:</strong><div style="margin-top:8px;color:#333;line-height:1.6;">‡§®‡§Æ‡§∏‡•ç‡§§‡•á! ‡§Æ‡•à‡§Ç KrishiMitra AI ‡§π‡•Ç‡§Å‡•§ ‡§ï‡•ã‡§à ‡§≠‡•Ä ‡§ï‡•É‡§∑‡§ø ‡§∏‡§Ç‡§¨‡§Ç‡§ß‡•Ä ‡§∏‡§µ‡§æ‡§≤ ‡§™‡•Ç‡§õ‡•á‡§Ç! üåæ</div></div>';
                        }
                    }

                    // ========================================
                    // MAKE FUNCTIONS GLOBALLY AVAILABLE
                    // ========================================
                    window.updateLocation = updateLocation;
                    window.searchLocations = searchLocations;
                    window.showLocationSuggestions = showLocationSuggestions;
                    window.selectLocation = selectLocation;
                    window.searchCurrentLocation = searchCurrentLocation;
                    window.detectLocation = detectLocation;
                    window.selectMandi = selectMandi;
                    window.onMandiSelected = onMandiSelected;
                    window.populateMandiDropdown = populateMandiDropdown;
                    window.showService = showService;
                    window.loadMarketPrices = loadMarketPrices;
                    window.loadWeatherData = loadWeatherData;
                    window.loadGovernmentSchemes = loadGovernmentSchemes;
                    window.loadCropRecommendations = loadCropRecommendations;
                    window.runKrishiRakshaDiagnosis = runKrishiRakshaDiagnosis;
                    window.submitKRFeedback = submitKRFeedback;
                    window.handleChatUserMessage = handleChatUserMessage;
                    window.sendMessage = handleChatUserMessage;
                    window.askSuggested = askSuggested;
                    window.clearChat = clearChat;

                    // ========================================
                    // AUTO-INITIALIZE
                    // ========================================
                    if (document.readyState === 'loading') {
                        document.addEventListener('DOMContentLoaded', function () {
                            console.log('üìä Page loaded, initializing...');
                            setupServiceCards();
                            setTimeout(() => {
                                loadMarketPrices();
                                loadWeatherData();
                                loadGovernmentSchemes();
                                loadCropRecommendations();
                            }, 500);
                        });
                    } else {
                        console.log('üìä Page already loaded, initializing...');
                        setupServiceCards();
                        setTimeout(() => {
                            loadMarketPrices();
                            loadWeatherData();
                            loadGovernmentSchemes();
                            loadCropRecommendations();
                        }, 500);
                    }
                }) ();
    </script>

    <!-- iot_blockchain.js inlined to avoid 404 static serving issues -->
    <!-- Compatibility Elements for Legacy JS -->
    <div id="legacy-compat-layer" style="display: none;">
        <form id="pestImageForm"></form>
        <div id="pestData"></div>
        <input id="cropImage" type="file">
        <input id="cropName" type="text">
        <textarea id="symptoms"></textarea>
        <input id="mandiLocationSearch" type="text">
        <input id="mandiCropSearch" type="text">
        <div id="mandiSearchResults"></div>
        <input id="chatInput" type="text">
        <div id="typingIndicator"></div>
        <textarea id="problemDescription"></textarea>
    </div>
</body>

</html>